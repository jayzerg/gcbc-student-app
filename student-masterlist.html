<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Masterlist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Prevent camera movement when filtering students */
        #studentTableContainer {
            min-height: 400px;
            transition: opacity 0.2s ease-in-out;
        }
        
        /* Smooth transitions for table visibility */
        #studentTableContainer.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        /* Ensure consistent button heights */
        .year-filter-btn {
            height: 44px;
            min-width: 80px;
        }
        
        /* Cool W3BFORGE BCC title styling */
        .brand-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            font-weight: 900;
            letter-spacing: 0.5px;
            text-shadow: 0 0 30px rgba(102, 126, 234, 0.3);
            position: relative;
            transition: all 0.3s ease;
        }
        
        .brand-title::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            border-radius: 12px;
            opacity: 0.1;
            z-index: -1;
            transition: opacity 0.3s ease;
        }
        
        .brand-title:hover {
            transform: translateY(-1px);
            filter: drop-shadow(0 4px 8px rgba(102, 126, 234, 0.4));
        }
        
        .brand-title:hover::before {
            opacity: 0.2;
        }
        
        .brand-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 8px 16px;
            box-shadow: 
                0 4px 6px rgba(0, 0, 0, 0.05),
                0 10px 15px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .brand-container::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.6s ease;
            opacity: 0;
        }
        
        .brand-container:hover::after {
            animation: shimmer 1.5s ease-in-out;
        }
        
        .brand-container:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 8px 25px rgba(102, 126, 234, 0.15),
                0 15px 35px rgba(118, 75, 162, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
        }
        
        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        @keyframes shimmer {
            0% {
                opacity: 0;
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }
        #successModal {
            backdrop-filter: blur(4px);
        }
        
        #successModal .bg-gradient-to-br {
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* Success icon pulse animation */
        .success-icon {
            animation: successPulse 1s ease-in-out;
        }
        
        @keyframes successPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-orange-50 to-blue-100">
    <!-- Navigation Bar -->
    <nav class="fixed top-0 left-0 right-0 bg-gradient-to-r from-blue-500 via-white to-orange-400 px-4 py-2 shadow-lg border-b-2 border-blue-300 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <img src="images/BCLOGO.png" alt="GCBC Logo" class="h-10 w-10 object-contain cursor-pointer bg-white rounded-full p-1 shadow-md border-2 border-blue-300 hover:border-orange-400 hover:shadow-lg hover:scale-110 transition-all duration-300" onclick="showSection('students')">
                <div class="brand-container">
                    <h1 class="brand-title text-lg font-black">W3BFORGE BCC</h1>
                </div>
            </div>
            <div class="relative">
                <button onclick="toggleDropdown()" class="flex items-center space-x-1 text-blue-800 hover:text-orange-600 transition duration-200 font-bold text-base tracking-wide">
                    <span class="font-serif">MENU</span>
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                <div id="dropdown" class="hidden absolute right-0 mt-2 w-48 bg-gradient-to-b from-blue-50 to-orange-50 rounded-md shadow-lg z-10 border border-blue-200">
                    <a href="#" onclick="showSection('students'); closeDropdown()" class="block px-4 py-2 text-blue-800 hover:bg-blue-100 hover:text-orange-600 transition duration-200 font-semibold tracking-wide">Student Masterlist</a>
                    <a href="#" onclick="showSection('grading'); closeDropdown()" class="block px-4 py-2 text-blue-800 hover:bg-orange-100 hover:text-blue-600 transition duration-200 font-semibold tracking-wide">Grading Remarks</a>
                    <a href="#" onclick="showSection('classrecord'); closeDropdown()" class="block px-4 py-2 text-blue-800 hover:bg-blue-100 hover:text-orange-600 transition duration-200 font-semibold tracking-wide">Class Record</a>
                    <a href="#" onclick="showSection('syllabus'); closeDropdown()" class="block px-4 py-2 text-blue-800 hover:bg-orange-100 hover:text-blue-600 rounded-b-md transition duration-200 font-semibold tracking-wide">Curriculum</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto p-4 sm:p-6 mt-16">
        <!-- Student Masterlist Section -->
        <div id="studentsSection">
            <h1 class="text-3xl sm:text-4xl font-bold text-center mb-6 sm:mb-8 text-gray-900">Student Masterlist</h1>
            
            <div class="grid grid-cols-1 gap-6 sm:gap-8">
                <!-- Add Student Form (Top) -->
                <div class="bg-gradient-to-r from-orange-50 to-blue-50 rounded-lg shadow-md p-4 sm:p-6 border border-orange-200">
                    <h2 class="text-xl sm:text-2xl font-bold mb-4 text-gray-800">Add New Student</h2>
                    <form id="studentForm" autocomplete="off" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                        <div>
                            <div class="flex items-center space-x-2 mb-2">
                                <label class="block text-base font-bold text-gray-900">Student ID</label>
                                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-semibold" title="System automatically fills gaps when students are deleted">📋 Smart Auto-ID</span>
                            </div>
                            <input type="text" id="studentId" required readonly class="w-full px-4 py-3 text-base border-2 border-gray-400 rounded-md bg-gray-100 cursor-not-allowed focus:outline-none" placeholder="Auto-generated (fills gaps intelligently)">
                        </div>
                        <div>
                            <label class="block text-base font-bold text-gray-900 mb-2">Last Name</label>
                            <div class="relative">
                                <input type="text" id="lastName" required maxlength="50" autocomplete="off" class="w-full px-4 py-3 pr-16 text-base border-2 border-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" oninput="updateCounter('lastName', 'lastNameCounter', 50)">
                                <span id="lastNameCounter" class="absolute right-3 top-3 text-sm font-semibold text-gray-600">0/50</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-base font-bold text-gray-900 mb-2">First Name</label>
                            <div class="relative">
                                <input type="text" id="firstName" required maxlength="50" autocomplete="off" class="w-full px-4 py-3 pr-16 text-base border-2 border-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" oninput="updateCounter('firstName', 'firstNameCounter', 50)">
                                <span id="firstNameCounter" class="absolute right-3 top-3 text-sm font-semibold text-gray-600">0/50</span>
                            </div>
                        </div>
                        <div>
                            <div class="flex items-center space-x-3 mb-2">
                                <label class="block text-base font-bold text-gray-900">Middle Name</label>
                                <input type="checkbox" id="hasMiddleName" onchange="toggleMiddleName()" class="rounded w-4 h-4">
                                <span class="text-sm font-semibold text-gray-700">Has middle name</span>
                            </div>
                            <div class="relative">
                                <input type="text" id="middleName" maxlength="50" autocomplete="off" disabled class="w-full px-4 py-3 pr-16 text-base border-2 border-gray-400 rounded-md bg-gray-100 cursor-not-allowed focus:outline-none" oninput="updateCounter('middleName', 'middleNameCounter', 50)">
                                <span id="middleNameCounter" class="absolute right-3 top-3 text-sm font-semibold text-gray-600">0/50</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-base font-bold text-gray-900 mb-2">Course</label>
                            <select id="course" required autocomplete="off" class="w-full px-4 py-3 text-base border-2 border-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select Course</option>
                                <option value="BSIT">BSIT</option>
                                <option value="BMMA">BMMA</option>
                                <option value="CUSTOM">CUSTOM</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-base font-bold text-gray-900 mb-2">Year Level</label>
                            <select id="yearLevel" required autocomplete="off" class="w-full px-4 py-3 text-base border-2 border-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select Year Level</option>
                                <option value="1st Year">1st Year</option>
                                <option value="2nd Year">2nd Year</option>
                                <option value="3rd Year">3rd Year</option>
                                <option value="4th Year">4th Year</option>
                            </select>
                        </div>
                        <div class="md:col-span-2 lg:col-span-3">
                            <div class="flex items-center space-x-3 mb-2">
                                <label class="block text-base font-bold text-gray-900">Address</label>
                                <button type="button" onclick="openAddressModal()" class="bg-blue-100 hover:bg-blue-200 border-2 border-blue-400 rounded px-3 py-2 text-sm font-semibold hover:scale-105 transition-all duration-200" title="Address Helper">
                                    ❓
                                </button>
                            </div>
                            <div class="relative">
                                <textarea id="address" required rows="3" maxlength="200" autocomplete="off" disabled class="w-full px-4 py-3 pr-20 text-base border-2 border-gray-400 rounded-md bg-gray-100 cursor-not-allowed" oninput="updateCounter('address', 'addressCounter', 200)"></textarea>
                                <span id="addressCounter" class="absolute right-3 top-3 text-sm font-semibold text-gray-600">0/200</span>
                            </div>
                        </div>
                        <div class="md:col-span-2 lg:col-span-3 flex space-x-4 mt-4">
                            <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 text-base rounded-md transition duration-200">
                                Add Student
                            </button>
                            <button type="button" onclick="resetForm()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 text-base rounded-md transition duration-200">
                                Reset
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Student List (Bottom) -->
                <div class="bg-gradient-to-r from-blue-50 to-orange-50 rounded-lg shadow-md p-4 sm:p-6 border border-blue-200">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl sm:text-2xl font-bold text-gray-800">Student List</h2>
                        <button onclick="toggleFilters()" class="text-xl sm:text-2xl hover:scale-110 transition-transform duration-200" title="Filters">
                            ⚙️
                        </button>
                    </div>
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button onclick="filterByYear('1st Year')" id="btn1st" class="year-filter-btn px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold rounded text-base transition duration-200">1st Year</button>
                        <button onclick="filterByYear('2nd Year')" id="btn2nd" class="year-filter-btn px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold rounded text-base transition duration-200">2nd Year</button>
                        <button onclick="filterByYear('3rd Year')" id="btn3rd" class="year-filter-btn px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold rounded text-base transition duration-200">3rd Year</button>
                        <button onclick="filterByYear('4th Year')" id="btn4th" class="year-filter-btn px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold rounded text-base transition duration-200">4th Year</button>
                        <button onclick="showAllYears()" id="btnAll" class="year-filter-btn px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-900 font-semibold rounded text-base transition duration-200">Show All</button>
                    </div>
                    <div class="student-table-wrapper">
                        <div id="studentTableContainer" class="overflow-x-auto">
                        <table class="w-full table-auto border-collapse border border-gray-300">
                            <thead>
                                <tr class="bg-gradient-to-r from-blue-100 to-orange-100">
                                    <th class="px-2 sm:px-3 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-16">No.</th>
                                    <th class="px-2 sm:px-3 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-24 cursor-pointer hover:bg-blue-200" ondblclick="toggleIdSort()" title="Double-click to sort">ID ↕️</th>
                                    <th class="px-2 sm:px-3 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-32">Last Name</th>
                                    <th class="px-2 sm:px-3 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-32">First Name</th>
                                    <th class="px-2 sm:px-3 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-20">Course</th>
                                    <th class="px-2 sm:px-3 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-28">Year Level</th>
                                    <th class="px-2 sm:px-3 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-32">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="studentTableBody">
                                <!-- Students will be added here -->
                            </tbody>
                        </table>
                    </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Class Record Section -->
        <div id="classrecordSection" class="hidden">
            <h1 class="text-3xl sm:text-4xl font-bold text-center mb-6 sm:mb-8 text-gray-900">Class Record</h1>
            <div class="bg-gradient-to-r from-blue-50 to-orange-50 rounded-lg shadow-md p-8 border border-blue-200 min-h-96">
                <!-- Class Record content will go here -->
            </div>
        </div>

        <!-- Syllabus Section -->
        <div id="syllabusSection" class="hidden">
            <h1 class="text-3xl sm:text-4xl font-bold text-center mb-6 sm:mb-8 text-gray-900">Curriculum</h1>
            <div class="bg-gradient-to-r from-blue-50 to-orange-50 rounded-lg shadow-md p-8 border border-blue-200 min-h-96">
                <p class="text-center text-gray-600">Curriculum content will be available soon.</p>
            </div>
        </div>

        <!-- Grading Period Section -->
        <div id="gradingSection" class="hidden">
            <h1 class="text-3xl sm:text-4xl font-bold text-center mb-6 sm:mb-8 text-gray-900">Grading Remarks</h1>
            
            <div class="flex mb-6 sm:mb-8">
                <div class="bg-gradient-to-r from-blue-50 to-orange-50 rounded-lg shadow-md p-4 border border-blue-200 mr-6">
                    <div class="flex flex-col space-y-4">
                        <!-- Prelim Icon -->
                        <div id="prelim-icon" class="text-center transition-all duration-500">
                            <button onclick="showGradingGrid('prelim')" class="text-3xl sm:text-4xl hover:scale-110 transition-transform duration-200">📚</button>
                            <p class="mt-1 text-xs sm:text-sm text-gray-700 font-medium">Prelim</p>
                        </div>
                        
                        <!-- Midterm Icon -->
                        <div id="midterm-icon" class="text-center transition-all duration-500">
                            <button onclick="showGradingGrid('midterm')" class="text-3xl sm:text-4xl hover:scale-110 transition-transform duration-200">📖</button>
                            <p class="mt-1 text-xs sm:text-sm text-gray-700 font-medium">Midterm</p>
                        </div>
                        
                        <!-- Finals Icon -->
                        <div id="finals-icon" class="text-center transition-all duration-500">
                            <button onclick="showGradingGrid('finals')" class="text-3xl sm:text-4xl hover:scale-110 transition-transform duration-200">🎓</button>
                            <p class="mt-1 text-xs sm:text-sm text-gray-700 font-medium">Finals</p>
                        </div>
                    </div>
                </div>
                <!-- Grading Grid -->
                <div id="gradingGrid" class="hidden flex-1">
                    <div class="bg-gradient-to-r from-blue-50 to-orange-50 rounded-lg shadow-md p-6 border border-blue-200">
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto">
                                <thead>
                                    <tr class="bg-gradient-to-r from-blue-100 to-orange-100">
                                        <th class="px-3 py-2 text-left text-sm font-medium text-gray-700">No.</th>
                                        <th class="px-3 py-2 text-left text-sm font-medium text-gray-700">Full Name</th>
                                        <th class="px-3 py-2 text-left text-sm font-medium text-gray-700">Final Grade</th>
                                        <th class="px-3 py-2 text-left text-sm font-medium text-gray-700">Remarks</th>
                                    </tr>
                                </thead>
                                <tbody id="gradingTableBody">
                                    <!-- Grading data will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Side Panel -->
    <div id="filterSidePanel" class="fixed top-0 right-0 h-full w-full sm:w-72 bg-gradient-to-b from-blue-50 to-orange-50 shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out z-40 border-l border-blue-200">
        <div class="p-3 sm:p-4">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-lg font-bold text-gray-900">Filters</h3>
                <button onclick="closeFilters()" class="text-gray-700 hover:text-gray-900 text-2xl font-bold">&times;</button>
            </div>
            <div class="space-y-3">
                <div>
                    <label class="block text-base font-bold text-gray-900 mb-2">Status</label>
                    <select id="statusFilter" class="w-full px-3 py-2.5 text-base font-semibold border-2 border-gray-400 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">All Status</option>
                        <option value="ACTIVE">Active</option>
                        <option value="PENDING">Pending</option>
                    </select>
                </div>
                <div>
                    <label class="block text-base font-bold text-gray-900 mb-2">Student ID</label>
                    <input type="text" id="searchId" placeholder="Enter Student ID" autocomplete="off" class="w-full px-3 py-2.5 text-base font-semibold border-2 border-gray-400 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-base font-bold text-gray-900 mb-2">Name</label>
                    <input type="text" id="searchName" placeholder="Last/First Name" autocomplete="off" class="w-full px-3 py-2.5 text-base font-semibold border-2 border-gray-400 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-base font-bold text-gray-900 mb-2">Course</label>
                    <select id="courseSort" class="w-full px-3 py-2.5 text-base font-semibold border-2 border-gray-400 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">All Courses</option>
                    </select>
                </div>
                <div>
                    <label class="block text-base font-bold text-gray-900 mb-2">Sort by ID</label>
                    <select id="idSort" class="w-full px-3 py-2.5 text-base font-semibold border-2 border-gray-400 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Default</option>
                        <option value="asc">Lowest to Highest</option>
                        <option value="desc">Highest to Lowest</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Overlay -->
    <div id="filterOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-30" onclick="closeFilters()"></div>

    <!-- Address Modal -->
    <div id="addressModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]">
        <div class="bg-gradient-to-br from-blue-50 to-orange-50 rounded-lg shadow-lg p-6 w-96 max-w-md mx-4 border border-blue-200">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold text-gray-700">Address Helper</h2>
                <button onclick="closeAddressModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
            </div>
            <div class="space-y-3">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                    <input type="text" id="country" value="PHL" readonly class="w-full px-3 py-2 border border-gray-300 rounded bg-gray-100 cursor-not-allowed focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Region</label>
                    <div class="relative">
                        <input type="text" id="region" readonly class="w-full px-3 py-2 pr-10 border border-gray-300 rounded bg-gray-100 cursor-not-allowed focus:outline-none">
                        <button type="button" onclick="toggleRegionDropdown()" class="absolute right-2 top-2 bg-blue-100 hover:bg-blue-200 border border-blue-300 rounded px-2 py-1 text-sm hover:scale-105 transition-all duration-200" title="Select Region">
                            📍
                        </button>
                        <div id="regionDropdown" class="hidden absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded shadow-lg max-h-48 overflow-y-auto z-30">
                            <button type="button" onclick="selectRegion('NCR')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">NCR - National Capital Region</button>
                            <button type="button" onclick="selectRegion('CAR')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">CAR - Cordillera Administrative Region</button>
                            <button type="button" onclick="selectRegion('Region I')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region I - Ilocos Region</button>
                            <button type="button" onclick="selectRegion('Region II')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region II - Cagayan Valley</button>
                            <button type="button" onclick="selectRegion('Region III')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region III - Central Luzon</button>
                            <button type="button" onclick="selectRegion('Region IV-A')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region IV-A - CALABARZON</button>
                            <button type="button" onclick="selectRegion('Region IV-B')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region IV-B - MIMAROPA</button>
                            <button type="button" onclick="selectRegion('Region V')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region V - Bicol Region</button>
                            <button type="button" onclick="selectRegion('Region VI')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region VI - Western Visayas</button>
                            <button type="button" onclick="selectRegion('Region VII')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region VII - Central Visayas</button>
                            <button type="button" onclick="selectRegion('Region VIII')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region VIII - Eastern Visayas</button>
                            <button type="button" onclick="selectRegion('Region IX')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region IX - Zamboanga Peninsula</button>
                            <button type="button" onclick="selectRegion('Region X')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region X - Northern Mindanao</button>
                            <button type="button" onclick="selectRegion('Region XI')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region XI - Davao Region</button>
                            <button type="button" onclick="selectRegion('Region XII')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region XII - SOCCSKSARGEN</button>
                            <button type="button" onclick="selectRegion('Region XIII')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region XIII - Caraga</button>
                            <button type="button" onclick="selectRegion('BARMM')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">BARMM - Bangsamoro Autonomous Region</button>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Province</label>
                    <div class="relative">
                        <input type="text" id="province" readonly class="w-full px-3 py-2 pr-10 border border-gray-300 rounded bg-gray-100 cursor-not-allowed focus:outline-none">
                        <button type="button" onclick="toggleProvinceDropdown()" class="absolute right-2 top-2 bg-blue-100 hover:bg-blue-200 border border-blue-300 rounded px-2 py-1 text-sm hover:scale-105 transition-all duration-200" title="Select Province">
                            📍
                        </button>
                        <div id="provinceDropdown" class="hidden absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded shadow-lg max-h-48 overflow-y-auto z-30">
                            <div id="provinceList" class="text-center py-4 text-gray-500">Please select a region first</div>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Municipality</label>
                    <div class="relative">
                        <input type="text" id="municipality" readonly class="w-full px-3 py-2 pr-10 border border-gray-300 rounded bg-gray-100 cursor-not-allowed focus:outline-none">
                        <button type="button" onclick="toggleMunicipalityDropdown()" class="absolute right-2 top-2 bg-blue-100 hover:bg-blue-200 border border-blue-300 rounded px-2 py-1 text-sm hover:scale-105 transition-all duration-200" title="Select Municipality">
                            📍
                        </button>
                        <div id="municipalityDropdown" class="hidden absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded shadow-lg max-h-48 overflow-y-auto z-30">
                            <div id="municipalityList" class="text-center py-4 text-gray-500">Please select a province first</div>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Barangay</label>
                    <div class="relative">
                        <input type="text" id="barangay" readonly class="w-full px-3 py-2 pr-10 border border-gray-300 rounded bg-gray-100 cursor-not-allowed focus:outline-none">
                        <button type="button" onclick="toggleBarangayDropdown()" class="absolute right-2 top-2 bg-blue-100 hover:bg-blue-200 border border-blue-300 rounded px-2 py-1 text-sm hover:scale-105 transition-all duration-200" title="Select Barangay">
                            📍
                        </button>
                        <div id="barangayDropdown" class="hidden absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded shadow-lg max-h-48 overflow-y-auto z-30">
                            <div id="barangayList" class="text-center py-4 text-gray-500">Please select a municipality first</div>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Street Address</label>
                    <input type="text" id="streetAddress" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                </div>
                <div class="flex space-x-3 mt-4">
                    <button onclick="generateAddress()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded transition duration-200">
                        Generate Address
                    </button>
                    <button onclick="closeAddressModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded transition duration-200">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Popup Modal -->
    <div id="successModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70]">
        <div class="bg-gradient-to-br from-green-50 to-blue-50 rounded-lg shadow-xl p-6 w-96 max-w-md mx-4 border-2 border-green-300 transform transition-all duration-300 scale-95">
            <div class="text-center">
                <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4 success-icon">
                    <svg class="h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">Student Added Successfully!</h3>
                <div id="successMessage" class="text-base font-semibold text-gray-700 mb-6">
                    <!-- Success message will be inserted here -->
                </div>
                <button onclick="closeSuccessModal()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-md transition duration-200 focus:outline-none focus:ring-2 focus:ring-green-500">
                    OK
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gradient-to-br from-blue-50 to-orange-50 rounded-lg shadow-lg p-6 w-80 max-w-md mx-4 border border-blue-200">
            <h2 class="text-lg font-semibold mb-4 text-gray-700">Confirm Delete</h2>
            <p class="text-gray-600 mb-6">Are you sure you want to delete this student? This action cannot be undone.</p>
            <div class="flex space-x-3">
                <button onclick="confirmDelete()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-md transition duration-200">
                    Delete
                </button>
                <button onclick="closeDeleteModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-md transition duration-200">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div id="editModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gradient-to-br from-blue-50 to-orange-50 rounded-lg shadow-lg p-6 w-full max-w-2xl mx-4 border border-blue-200 max-h-[90vh] overflow-y-auto">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Edit Student</h2>
            <form id="editForm" class="space-y-3">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Student ID</label>
                    <input type="text" id="editStudentId" disabled class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                    <div class="relative">
                        <input type="text" id="editLastName" required maxlength="50" class="w-full px-3 py-2 pr-12 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" oninput="updateCounter('editLastName', 'editLastNameCounter', 50)">
                        <span id="editLastNameCounter" class="absolute right-3 top-2 text-xs text-gray-500">0/50</span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                    <div class="relative">
                        <input type="text" id="editFirstName" required maxlength="50" class="w-full px-3 py-2 pr-12 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" oninput="updateCounter('editFirstName', 'editFirstNameCounter', 50)">
                        <span id="editFirstNameCounter" class="absolute right-3 top-2 text-xs text-gray-500">0/50</span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Middle Name (Optional)</label>
                    <div class="relative">
                        <input type="text" id="editMiddleName" maxlength="50" class="w-full px-3 py-2 pr-12 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" oninput="updateCounter('editMiddleName', 'editMiddleNameCounter', 50)">
                        <span id="editMiddleNameCounter" class="absolute right-3 top-2 text-xs text-gray-500">0/50</span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Course</label>
                    <select id="editCourse" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Course</option>
                        <option value="BSIT">BSIT</option>
                        <option value="BMMA">BMMA</option>
                        <option value="CUSTOM">CUSTOM</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Year Level</label>
                    <select id="editYearLevel" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Year Level</option>
                        <option value="1st Year">1st Year</option>
                        <option value="2nd Year">2nd Year</option>
                        <option value="3rd Year">3rd Year</option>
                        <option value="4th Year">4th Year</option>
                    </select>
                </div>
                <div>
                    <div class="flex items-center space-x-2 mb-1">
                        <label class="block text-sm font-medium text-gray-700">Address</label>
                        <button type="button" onclick="openEditAddressModal()" class="bg-blue-100 hover:bg-blue-200 border border-blue-300 rounded px-2 py-1 text-sm hover:scale-105 transition-all duration-200" title="Address Helper">
                            ❓
                        </button>
                    </div>
                    <div class="relative">
                        <textarea id="editAddress" required rows="3" maxlength="200" disabled class="w-full px-3 py-2 pr-16 border border-gray-300 rounded-md bg-gray-100 cursor-not-allowed" oninput="updateCounter('editAddress', 'editAddressCounter', 200)"></textarea>
                        <span id="editAddressCounter" class="absolute right-3 top-2 text-xs text-gray-500">0/200</span>
                    </div>
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200">
                        Update Student
                    </button>
                    <button type="button" onclick="closeEditModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-md transition duration-200">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Status Modal -->
    <div id="statusModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gradient-to-br from-blue-50 to-orange-50 rounded-lg shadow-lg p-6 w-80 max-w-md mx-4 border border-blue-200">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Student Status</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Current Status:</label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="studentStatus" value="ACTIVE" class="mr-2">
                            <span class="text-green-600 font-medium">ACTIVE</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="studentStatus" value="PENDING" class="mr-2">
                            <span class="text-yellow-600 font-medium">PENDING</span>
                        </label>
                    </div>
                </div>
                <div class="flex space-x-3 mt-6">
                    <button onclick="updateStatus()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200">
                        Update Status
                    </button>
                    <button onclick="closeStatusModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-md transition duration-200">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';

        // Auto-generate student ID functionality with gap filling
        async function generateNextStudentId() {
            try {
                const response = await fetch(`${API_BASE}/students`);
                const students = await response.json();
                
                if (students.length === 0) {
                    return '25-0000001';
                }
                
                // Extract all existing student ID numbers
                const existingNumbers = [];
                students.forEach(student => {
                    if (student.studentId && student.studentId.startsWith('25-')) {
                        const numberPart = student.studentId.split('-')[1];
                        const number = parseInt(numberPart, 10);
                        if (!isNaN(number)) {
                            existingNumbers.push(number);
                        }
                    }
                });
                
                // Sort the numbers to find gaps
                existingNumbers.sort((a, b) => a - b);
                
                // Find the first available gap, or use next sequential number
                let nextNumber = 1;
                for (let i = 0; i < existingNumbers.length; i++) {
                    if (existingNumbers[i] === nextNumber) {
                        nextNumber++;
                    } else if (existingNumbers[i] > nextNumber) {
                        // Found a gap! Use the missing number
                        break;
                    }
                }
                
                // Generate the ID with proper padding
                const paddedNumber = nextNumber.toString().padStart(7, '0');
                return `25-${paddedNumber}`;
                
            } catch (error) {
                console.error('Error generating student ID:', error);
                // Fallback to timestamp-based ID if there's an error
                const timestamp = Date.now().toString().slice(-7);
                return `25-${timestamp.padStart(7, '0')}`;
            }
        }

        // Set the auto-generated ID when page loads
        async function setAutoGeneratedId() {
            const studentIdField = document.getElementById('studentId');
            const nextId = await generateNextStudentId();
            studentIdField.value = nextId;
            
            // Ensure middle name field is properly disabled
            resetMiddleNameField();
        }
        
        // Helper function to properly reset middle name field
        function resetMiddleNameField() {
            const middleNameField = document.getElementById('middleName');
            const middleNameCheckbox = document.getElementById('hasMiddleName');
            
            // Ensure checkbox is unchecked
            middleNameCheckbox.checked = false;
            
            // Disable and style the middle name field
            middleNameField.disabled = true;
            middleNameField.value = '';
            middleNameField.classList.add('bg-gray-100', 'cursor-not-allowed');
            middleNameField.classList.remove('focus:ring-2', 'focus:ring-blue-500', 'focus:border-blue-500');
            
            // Update counter
            updateCounter('middleName', 'middleNameCounter', 50);
        }

        // Load students on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadStudents();
            setAutoGeneratedId(); // Set auto-generated student ID
        });

        document.getElementById('studentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const student = {
                studentId: document.getElementById('studentId').value,
                lastName: document.getElementById('lastName').value,
                firstName: document.getElementById('firstName').value,
                middleName: document.getElementById('middleName').value,
                course: document.getElementById('course').value,
                yearLevel: document.getElementById('yearLevel').value,
                address: document.getElementById('address').value
            };

            try {
                const response = await fetch(`${API_BASE}/students`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(student)
                });

                if (response.ok) {
                    // Reset form but keep the student ID field disabled
                    this.reset();
                    
                    // Properly reset middle name field
                    resetMiddleNameField();
                    
                    // Generate new ID for next student
                    await setAutoGeneratedId();
                    loadStudents();
                    
                    // Show custom success popup instead of browser alert
                    const fullName = `${student.firstName} ${student.lastName}`;
                    showSuccessModal(fullName, student.studentId);
                } else {
                    const error = await response.json();
                    alert(error.error);
                }
            } catch (error) {
                alert('Error adding student: ' + error.message);
            }
        });

        async function loadStudents() {
            try {
                const response = await fetch(`${API_BASE}/students`);
                const students = await response.json();
                displayStudents(students);
            } catch (error) {
                console.error('Error loading students:', error);
            }
        }

        function displayStudents(students) {
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';

            students.forEach((student, index) => {
                const status = student.status || 'PENDING';
                const statusEmoji = status === 'ACTIVE' ? '✅' : '⏳';
                const statusColor = status === 'ACTIVE' ? 'bg-green-500 hover:bg-green-600' : 'bg-yellow-500 hover:bg-yellow-600';
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td class="px-2 sm:px-3 py-3 border border-gray-300 text-sm font-semibold text-gray-900 text-center">${index + 1}</td>
                    <td class="px-2 sm:px-3 py-3 border border-gray-300 text-sm font-semibold text-gray-900">${student.studentId}</td>
                    <td class="px-2 sm:px-3 py-3 border border-gray-300 text-sm font-semibold text-gray-900">${student.lastName}</td>
                    <td class="px-2 sm:px-3 py-3 border border-gray-300 text-sm font-semibold text-gray-900">${student.firstName}</td>
                    <td class="px-2 sm:px-3 py-3 border border-gray-300 text-sm font-semibold text-gray-900">${student.course || ''}</td>
                    <td class="px-2 sm:px-3 py-3 border border-gray-300 text-sm font-semibold text-gray-900">${student.yearLevel || ''}</td>
                    <td class="px-2 sm:px-3 py-3 border border-gray-300">
                        <button onclick="editStudent('${student._id}')" class="bg-blue-500 hover:bg-blue-600 text-white p-2 rounded mr-1 text-sm font-bold" title="Edit">
                            ✏️
                        </button>
                        <button onclick="openStatusModal('${student._id}')" class="${statusColor} text-white p-2 rounded mr-1 text-sm font-bold" title="Status: ${status}">
                            ${statusEmoji}
                        </button>
                        <button onclick="deleteStudent('${student._id}')" class="bg-red-500 hover:bg-red-600 text-white p-2 rounded text-sm font-bold" title="Delete">
                            🗑️
                        </button>
                    </td>
                `;
            });
        }

        // Success modal functions
        function showSuccessModal(studentName, studentId) {
            const modal = document.getElementById('successModal');
            const messageDiv = document.getElementById('successMessage');
            
            messageDiv.innerHTML = `
                <p class="mb-2"><strong>Name:</strong> ${studentName}</p>
                <p><strong>Student ID:</strong> ${studentId}</p>
            `;
            
            modal.classList.remove('hidden');
            modal.querySelector('.bg-gradient-to-br').classList.remove('scale-95');
            modal.querySelector('.bg-gradient-to-br').classList.add('scale-100');
            document.body.style.overflow = 'hidden';
            
            // Auto close after 5 seconds
            setTimeout(() => {
                closeSuccessModal();
            }, 5000);
        }
        
        function closeSuccessModal() {
            const modal = document.getElementById('successModal');
            const modalContent = modal.querySelector('.bg-gradient-to-br');
            
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }, 300);
        }
        
        let studentToDelete = null;
        
        function deleteStudent(id) {
            studentToDelete = id;
            document.getElementById('deleteModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        function closeDeleteModal() {
            studentToDelete = null;
            document.getElementById('deleteModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        async function confirmDelete() {
            if (studentToDelete) {
                try {
                    await fetch(`${API_BASE}/students/${studentToDelete}`, { method: 'DELETE' });
                    loadStudents();
                    closeDeleteModal();
                } catch (error) {
                    alert('Error deleting student: ' + error.message);
                }
            }
        }

        function showSection(section) {
            document.getElementById('studentsSection').classList.add('hidden');
            document.getElementById('gradingSection').classList.add('hidden');
            document.getElementById('classrecordSection').classList.add('hidden');
            document.getElementById('syllabusSection').classList.add('hidden');
            
            if (section === 'students') {
                document.getElementById('studentsSection').classList.remove('hidden');
                // Reset grading period layout
                resetGradingPeriod();
            } else if (section === 'grading') {
                document.getElementById('gradingSection').classList.remove('hidden');
            } else if (section === 'classrecord') {
                document.getElementById('classrecordSection').classList.remove('hidden');
            } else if (section === 'syllabus') {
                document.getElementById('syllabusSection').classList.remove('hidden');
            }
        }
        
        // Load curriculum data
        async function loadCurriculum() {
            try {
                // Load First Year First Semester
                const response1_1 = await fetch(`${API_BASE}/curriculum/1/1`);
                const subjects1_1 = await response1_1.json();
                displayCurriculum(subjects1_1, 'curriculum-1-1-body');
                
                // Load First Year Second Semester
                const response1_2 = await fetch(`${API_BASE}/curriculum/1/2`);
                const subjects1_2 = await response1_2.json();
                displayCurriculum(subjects1_2, 'curriculum-1-2-body');
                
                // Load Second Year First Semester
                const response2_1 = await fetch(`${API_BASE}/curriculum/2/1`);
                const subjects2_1 = await response2_1.json();
                displayCurriculum(subjects2_1, 'curriculum-2-1-body');
                
                // Load Second Year Second Semester
                const response2_2 = await fetch(`${API_BASE}/curriculum/2/2`);
                const subjects2_2 = await response2_2.json();
                displayCurriculum(subjects2_2, 'curriculum-2-2-body');
                

            } catch (error) {
                console.error('Error loading curriculum:', error);
            }
        }
        
        function displayCurriculum(subjects, tbodyId) {
            const tbody = document.getElementById(tbodyId);
            tbody.innerHTML = '';
            
            let totalLec = 0, totalLab = 0, totalUnits = 0;
            
            subjects.forEach(subject => {
                totalLec += subject.lecUnits;
                totalLab += subject.labUnits;
                totalUnits += subject.totalUnits;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td class="px-3 py-2 border border-gray-300 text-sm">${subject.code}</td>
                    <td class="px-3 py-2 border border-gray-300 text-sm">${subject.title}</td>
                    <td class="px-3 py-2 border border-gray-300 text-sm text-center">${subject.lecUnits}</td>
                    <td class="px-3 py-2 border border-gray-300 text-sm text-center">${subject.labUnits}</td>
                    <td class="px-3 py-2 border border-gray-300 text-sm text-center">${subject.totalUnits}</td>
                    <td class="px-3 py-2 border border-gray-300 text-sm">${subject.prerequisite}</td>
                `;
            });
            
            // Add total row
            const totalRow = tbody.insertRow();
            totalRow.innerHTML = `
                <td class="px-3 py-2 border border-gray-300 text-sm font-bold" colspan="2">Total</td>
                <td class="px-3 py-2 border border-gray-300 text-sm font-bold text-center">${totalLec}</td>
                <td class="px-3 py-2 border border-gray-300 text-sm font-bold text-center">${totalLab}</td>
                <td class="px-3 py-2 border border-gray-300 text-sm font-bold text-center">${totalUnits}</td>
                <td class="px-3 py-2 border border-gray-300 text-sm"></td>
            `;
            totalRow.classList.add('bg-gray-100');
        }

        function resetGradingPeriod() {
            // Hide grading grid
            document.getElementById('gradingGrid').classList.add('hidden');
            
            // Reset all icon styles
            const allIcons = ['prelim-icon', 'midterm-icon', 'finals-icon'];
            allIcons.forEach(iconId => {
                const icon = document.getElementById(iconId);
                icon.classList.remove('blur-sm', 'opacity-50', 'scale-110');
            });
        }

        function editStudent(id) {
            fetch(`${API_BASE}/students`)
                .then(response => response.json())
                .then(students => {
                    const student = students.find(s => s._id === id);
                    if (student) {
                        // Populate modal form with student data
                        document.getElementById('editStudentId').value = student.studentId;
                        document.getElementById('editLastName').value = student.lastName;
                        document.getElementById('editFirstName').value = student.firstName;
                        document.getElementById('editMiddleName').value = student.middleName || '';
                        document.getElementById('editCourse').value = student.course || '';
                        document.getElementById('editYearLevel').value = student.yearLevel || '';
                        
                        // Enable address field temporarily to set value
                        const editAddressField = document.getElementById('editAddress');
                        editAddressField.disabled = false;
                        editAddressField.value = student.address;
                        editAddressField.disabled = true;
                        
                        // Update character counters
                        updateCounter('editLastName', 'editLastNameCounter', 50);
                        updateCounter('editFirstName', 'editFirstNameCounter', 50);
                        updateCounter('editMiddleName', 'editMiddleNameCounter', 50);
                        updateCounter('editAddress', 'editAddressCounter', 200);
                        
                        // Store student ID for update
                        document.getElementById('editForm').setAttribute('data-student-id', id);
                        
                        // Show modal
                        document.getElementById('editModal').classList.remove('hidden');
                        document.body.style.overflow = 'hidden';
                    }
                })
                .catch(error => {
                    alert('Error loading student data: ' + error.message);
                });
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // Edit form submission
        document.getElementById('editForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const studentId = this.getAttribute('data-student-id');
            const updatedStudent = {
                lastName: document.getElementById('editLastName').value,
                firstName: document.getElementById('editFirstName').value,
                middleName: document.getElementById('editMiddleName').value,
                course: document.getElementById('editCourse').value,
                yearLevel: document.getElementById('editYearLevel').value,
                address: document.getElementById('editAddress').value
            };

            try {
                const response = await fetch(`${API_BASE}/students/${studentId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedStudent)
                });

                if (response.ok) {
                    closeEditModal();
                    loadStudents();
                } else {
                    const error = await response.json();
                    alert(error.error);
                }
            } catch (error) {
                alert('Error updating student: ' + error.message);
            }
        });

        // Filter functionality
        let allStudents = [];
        
        function applyFilters() {
            const statusFilter = document.getElementById('statusFilter').value;
            const idSearch = document.getElementById('searchId').value.toLowerCase();
            const nameSearch = document.getElementById('searchName').value.toLowerCase();
            const courseFilter = document.getElementById('courseSort').value;
            const idSort = document.getElementById('idSort').value;
            
            let filteredStudents = allStudents.filter(student => {
                const matchesStatus = !statusFilter || (student.status || 'PENDING') === statusFilter;
                const matchesId = !idSearch || student.studentId.toLowerCase().includes(idSearch);
                const matchesName = !nameSearch || 
                    student.lastName.toLowerCase().includes(nameSearch) ||
                    student.firstName.toLowerCase().includes(nameSearch);
                const matchesCourse = !courseFilter || student.course === courseFilter;
                
                return matchesStatus && matchesId && matchesName && matchesCourse;
            });
            
            // Sort by Student ID if selected
            if (idSort === 'asc') {
                filteredStudents.sort((a, b) => a.studentId.localeCompare(b.studentId, undefined, { numeric: true }));
            } else if (idSort === 'desc') {
                filteredStudents.sort((a, b) => b.studentId.localeCompare(a.studentId, undefined, { numeric: true }));
            }
            
            displayStudents(filteredStudents);
        }
        
        document.getElementById('statusFilter').addEventListener('change', applyFilters);
        document.getElementById('searchId').addEventListener('input', applyFilters);
        document.getElementById('searchName').addEventListener('input', applyFilters);
        document.getElementById('courseSort').addEventListener('change', applyFilters);
        document.getElementById('idSort').addEventListener('change', applyFilters);
        
        function populateCourseFilter() {
            const courseSelect = document.getElementById('courseSort');
            const courses = [...new Set(allStudents.map(s => s.course).filter(c => c))];
            
            courseSelect.innerHTML = '<option value="">All Courses</option>';
            courses.forEach(course => {
                courseSelect.innerHTML += `<option value="${course}">${course}</option>`;
            });
        }

        // Update loadStudents to store all students
        async function loadStudents() {
            try {
                const response = await fetch(`${API_BASE}/students`);
                allStudents = await response.json();
                populateCourseFilter();
                displayStudents(allStudents);
            } catch (error) {
                console.error('Error loading students:', error);
            }
        }

        // Dropdown functionality
        function toggleDropdown() {
            const dropdown = document.getElementById('dropdown');
            dropdown.classList.toggle('hidden');
        }

        function closeDropdown() {
            document.getElementById('dropdown').classList.add('hidden');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('dropdown');
            const menuButton = event.target.closest('button');
            if (!menuButton || menuButton.onclick.toString().indexOf('toggleDropdown') === -1) {
                dropdown.classList.add('hidden');
            }
        });

        // Grading grid functions
        async function showGradingGrid(period) {
            const grid = document.getElementById('gradingGrid');
            const tbody = document.getElementById('gradingTableBody');
            
            // Apply blur animation to other icons
            const allIcons = ['prelim-icon', 'midterm-icon', 'finals-icon'];
            allIcons.forEach(iconId => {
                const icon = document.getElementById(iconId);
                if (iconId === period + '-icon') {
                    icon.classList.remove('blur-sm', 'opacity-50');
                    icon.classList.add('scale-110');
                } else {
                    icon.classList.add('blur-sm', 'opacity-50');
                    icon.classList.remove('scale-110');
                }
            });
            
            // Show blank grid for all periods
            tbody.innerHTML = '<tr><td colspan="4" class="px-3 py-8 text-center text-gray-500">No data available for ' + period + ' period</td></tr>';
            
            grid.classList.remove('hidden');
        }

        async function loadGradingData(yearFilter = '') {
            try {
                const response = await fetch(`${API_BASE}/students`);
                let students = await response.json();
                
                if (yearFilter) {
                    students = students.filter(student => student.yearLevel === yearFilter);
                }
                
                displayGradingData(students);
            } catch (error) {
                console.error('Error loading grading data:', error);
            }
        }

        function displayGradingData(students) {
            const tbody = document.getElementById('gradingTableBody');
            tbody.innerHTML = '';

            students.forEach((student, index) => {
                const fullName = `${student.lastName}, ${student.firstName}`;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td class="px-3 py-2 border-b text-sm text-center">${index + 1}</td>
                    <td class="px-3 py-2 border-b text-sm">${fullName}</td>
                    <td class="px-3 py-2 border-b text-sm text-center">-</td>
                    <td class="px-3 py-2 border-b text-sm text-center">-</td>
                `;
            });
        }

        function addGrade(studentId, lastName) {
            alert(`Add grade for Student ID: ${studentId}, Last Name: ${lastName}`);
        }



        // Toggle filter side panel
        function toggleFilters() {
            const sidePanel = document.getElementById('filterSidePanel');
            const overlay = document.getElementById('filterOverlay');
            
            sidePanel.classList.remove('translate-x-full');
            overlay.classList.remove('hidden');
        }
        
        function closeFilters() {
            const sidePanel = document.getElementById('filterSidePanel');
            const overlay = document.getElementById('filterOverlay');
            
            sidePanel.classList.add('translate-x-full');
            overlay.classList.add('hidden');
        }

        // ID column sorting
        let currentIdSort = 'default';
        
        function toggleIdSort() {
            const idSortSelect = document.getElementById('idSort');
            
            if (currentIdSort === 'default' || currentIdSort === 'desc') {
                currentIdSort = 'asc';
                idSortSelect.value = 'asc';
            } else {
                currentIdSort = 'desc';
                idSortSelect.value = 'desc';
            }
            
            applyFilters();
        }

        // Status modal functions
        function openStatusModal(studentId) {
            fetch(`${API_BASE}/students`)
                .then(response => response.json())
                .then(students => {
                    const student = students.find(s => s._id === studentId);
                    if (student) {
                        // Set current status or default to PENDING
                        const currentStatus = student.status || 'PENDING';
                        document.querySelector(`input[name="studentStatus"][value="${currentStatus}"]`).checked = true;
                        
                        // Store student ID for update
                        document.getElementById('statusModal').setAttribute('data-student-id', studentId);
                        
                        // Show modal
                        document.getElementById('statusModal').classList.remove('hidden');
                        document.body.style.overflow = 'hidden';
                    }
                })
                .catch(error => {
                    alert('Error loading student data: ' + error.message);
                });
        }

        function closeStatusModal() {
            document.getElementById('statusModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        async function updateStatus() {
            const modal = document.getElementById('statusModal');
            const studentId = modal.getAttribute('data-student-id');
            const selectedStatus = document.querySelector('input[name="studentStatus"]:checked')?.value;
            
            if (!selectedStatus) {
                alert('Please select a status');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/students/${studentId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status: selectedStatus })
                });

                if (response.ok) {
                    closeStatusModal();
                    loadStudents();
                    
                    // Refresh grading grid if it's currently visible
                    const gradingGrid = document.getElementById('gradingGrid');
                    if (!gradingGrid.classList.contains('hidden')) {
                        await loadGradingData('');
                    }
                } else {
                    const error = await response.json();
                    alert(error.error);
                }
            } catch (error) {
                alert('Error updating status: ' + error.message);
            }
        }

        // Character counter function
        function updateCounter(inputId, counterId, maxLength) {
            const input = document.getElementById(inputId);
            const counter = document.getElementById(counterId);
            const currentLength = input.value.length;
            
            counter.textContent = `${currentLength}/${maxLength}`;
            
            // Change color when approaching limit
            if (currentLength >= maxLength * 0.9) {
                counter.classList.add('text-red-500');
                counter.classList.remove('text-gray-500');
            } else {
                counter.classList.add('text-gray-500');
                counter.classList.remove('text-red-500');
            }
        }

        // Address modal functions
        function openAddressModal() {
            document.getElementById('addressModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeAddressModal() {
            document.getElementById('addressModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function generateAddress() {
            const country = document.getElementById('country').value.trim();
            const region = document.getElementById('region').value.trim();
            const province = document.getElementById('province').value.trim();
            const municipality = document.getElementById('municipality').value.trim();
            const barangay = document.getElementById('barangay').value.trim();
            const streetAddress = document.getElementById('streetAddress').value.trim();
            
            const addressParts = [streetAddress, barangay, municipality, province, region, country].filter(part => part !== '');
            const fullAddress = addressParts.join(', ');
            
            // Check if we're in edit mode
            const isEditMode = document.getElementById('addressModal').getAttribute('data-edit-mode') === 'true';
            
            if (isEditMode) {
                // Enable edit address field temporarily to set value
                const editAddressField = document.getElementById('editAddress');
                editAddressField.disabled = false;
                editAddressField.value = fullAddress;
                updateCounter('editAddress', 'editAddressCounter', 200);
                editAddressField.disabled = true;
                
                // Clear edit mode flag
                document.getElementById('addressModal').removeAttribute('data-edit-mode');
            } else {
                // Enable main address field temporarily to set value
                const addressField = document.getElementById('address');
                addressField.disabled = false;
                addressField.value = fullAddress;
                updateCounter('address', 'addressCounter', 200);
                addressField.disabled = true;
            }
            
            // Clear all fields except country
            document.getElementById('region').value = '';
            document.getElementById('province').value = '';
            document.getElementById('municipality').value = '';
            document.getElementById('barangay').value = '';
            document.getElementById('streetAddress').value = '';
            
            closeAddressModal();
        }

        function toggleRegionDropdown() {
            document.getElementById('regionDropdown').classList.toggle('hidden');
        }

        function selectRegion(region) {
            document.getElementById('region').value = region;
            document.getElementById('regionDropdown').classList.add('hidden');
            
            // Clear dependent fields
            document.getElementById('province').value = '';
            document.getElementById('municipality').value = '';
            document.getElementById('barangay').value = '';
            
            // Load provinces for selected region
            loadProvinces(region);
        }

        // Philippine address data cache
        let addressCache = {
            provinces: {},
            municipalities: {},
            barangays: {}
        };

        async function loadProvinces(region) {
            const provinceList = document.getElementById('provinceList');
            provinceList.innerHTML = '<div class="text-center py-4 text-gray-500">Loading...</div>';
            
            try {
                if (!addressCache.provinces[region]) {
                    const response = await fetch(`https://psgc.gitlab.io/api/provinces/`);
                    const allProvinces = await response.json();
                    
                    // Complete region to province mapping
                    const regionMapping = {
                        'NCR': ['Metro Manila'],
                        'CAR': ['Abra', 'Apayao', 'Benguet', 'Ifugao', 'Kalinga', 'Mountain Province'],
                        'Region I': ['Ilocos Norte', 'Ilocos Sur', 'La Union', 'Pangasinan'],
                        'Region II': ['Batanes', 'Cagayan', 'Isabela', 'Nueva Vizcaya', 'Quirino'],
                        'Region III': ['Aurora', 'Bataan', 'Bulacan', 'Nueva Ecija', 'Pampanga', 'Tarlac', 'Zambales'],
                        'Region IV-A': ['Batangas', 'Cavite', 'Laguna', 'Quezon', 'Rizal'],
                        'Region IV-B': ['Marinduque', 'Occidental Mindoro', 'Oriental Mindoro', 'Palawan', 'Romblon'],
                        'Region V': ['Albay', 'Camarines Norte', 'Camarines Sur', 'Catanduanes', 'Masbate', 'Sorsogon'],
                        'Region VI': ['Aklan', 'Antique', 'Capiz', 'Guimaras', 'Iloilo', 'Negros Occidental'],
                        'Region VII': ['Bohol', 'Cebu', 'Negros Oriental', 'Siquijor'],
                        'Region VIII': ['Biliran', 'Eastern Samar', 'Leyte', 'Northern Samar', 'Samar', 'Southern Leyte'],
                        'Region IX': ['Zamboanga del Norte', 'Zamboanga del Sur', 'Zamboanga Sibugay'],
                        'Region X': ['Bukidnon', 'Camiguin', 'Lanao del Norte', 'Misamis Occidental', 'Misamis Oriental'],
                        'Region XI': ['Davao de Oro', 'Davao del Norte', 'Davao del Sur', 'Davao Occidental', 'Davao Oriental'],
                        'Region XII': ['Cotabato', 'Sarangani', 'South Cotabato', 'Sultan Kudarat'],
                        'Region XIII': ['Agusan del Norte', 'Agusan del Sur', 'Dinagat Islands', 'Surigao del Norte', 'Surigao del Sur'],
                        'BARMM': ['Basilan', 'Lanao del Sur', 'Maguindanao', 'Sulu', 'Tawi-Tawi']
                    };
                    
                    addressCache.provinces[region] = regionMapping[region] || [];
                }
                
                const provinces = addressCache.provinces[region];
                
                if (provinces.length === 0) {
                    provinceList.innerHTML = '<div class="text-center py-4 text-gray-500">No provinces available</div>';
                    return;
                }
                
                provinceList.innerHTML = provinces.map(province => 
                    `<button type="button" onclick="selectProvince('${province}')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">${province}</button>`
                ).join('');
            } catch (error) {
                provinceList.innerHTML = '<div class="text-center py-4 text-red-500">Error loading provinces</div>';
            }
        }

        async function loadMunicipalities(province) {
            const municipalityList = document.getElementById('municipalityList');
            municipalityList.innerHTML = '<div class="text-center py-4 text-gray-500">Loading...</div>';
            
            try {
                if (!addressCache.municipalities[province]) {
                    // Get province code first
                    const provinceResponse = await fetch(`https://psgc.gitlab.io/api/provinces/`);
                    const allProvinces = await provinceResponse.json();
                    const provinceData = allProvinces.find(p => p.name === province);
                    
                    if (!provinceData) {
                        municipalityList.innerHTML = '<div class="text-center py-4 text-gray-500">Province not found</div>';
                        return;
                    }
                    
                    // Get municipalities for this province
                    const municipalityResponse = await fetch(`https://psgc.gitlab.io/api/cities-municipalities/`);
                    const allMunicipalities = await municipalityResponse.json();
                    
                    // Filter by province code
                    addressCache.municipalities[province] = allMunicipalities
                        .filter(m => m.provinceCode === provinceData.code)
                        .map(m => ({ name: m.name, code: m.code }));
                }
                
                const municipalities = addressCache.municipalities[province];
                
                if (municipalities.length === 0) {
                    municipalityList.innerHTML = '<div class="text-center py-4 text-gray-500">No municipalities available</div>';
                    return;
                }
                
                municipalityList.innerHTML = municipalities.map(municipality => 
                    `<button type="button" onclick="selectMunicipality('${municipality.name}', '${municipality.code}')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">${municipality.name}</button>`
                ).join('');
            } catch (error) {
                municipalityList.innerHTML = '<div class="text-center py-4 text-red-500">Error loading municipalities</div>';
            }
        }

        async function loadBarangays(municipality, municipalityCode) {
            const barangayList = document.getElementById('barangayList');
            barangayList.innerHTML = '<div class="text-center py-4 text-gray-500">Loading...</div>';
            
            try {
                if (!addressCache.barangays[municipality]) {
                    const response = await fetch(`https://psgc.gitlab.io/api/barangays/`);
                    const allBarangays = await response.json();
                    
                    // Try different possible field names for municipality code
                    addressCache.barangays[municipality] = allBarangays
                        .filter(b => b.cityMunCode === municipalityCode || b.municipalityCode === municipalityCode || b.code?.startsWith(municipalityCode?.substring(0, 6)))
                        .slice(0, 50)
                        .map(b => b.name);
                }
                
                const barangays = addressCache.barangays[municipality];
                
                if (barangays.length === 0) {
                    barangayList.innerHTML = '<div class="text-center py-4 text-gray-500">No barangays available</div>';
                    return;
                }
                
                barangayList.innerHTML = barangays.map(barangay => 
                    `<button type="button" onclick="selectBarangay('${barangay}')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">${barangay}</button>`
                ).join('');
            } catch (error) {
                barangayList.innerHTML = '<div class="text-center py-4 text-red-500">Error loading barangays</div>';
            }
        }

        function toggleProvinceDropdown() {
            document.getElementById('provinceDropdown').classList.toggle('hidden');
        }

        function toggleMunicipalityDropdown() {
            document.getElementById('municipalityDropdown').classList.toggle('hidden');
        }

        function toggleBarangayDropdown() {
            document.getElementById('barangayDropdown').classList.toggle('hidden');
        }

        function selectProvince(province) {
            document.getElementById('province').value = province;
            document.getElementById('provinceDropdown').classList.add('hidden');
            
            // Clear dependent fields
            document.getElementById('municipality').value = '';
            document.getElementById('barangay').value = '';
            
            // Load municipalities for selected province
            loadMunicipalities(province);
        }

        function selectMunicipality(municipality, municipalityCode) {
            document.getElementById('municipality').value = municipality;
            document.getElementById('municipalityDropdown').classList.add('hidden');
            
            // Clear dependent field
            document.getElementById('barangay').value = '';
            
            // Load barangays for selected municipality
            loadBarangays(municipality, municipalityCode);
        }

        function selectBarangay(barangay) {
            document.getElementById('barangay').value = barangay;
            document.getElementById('barangayDropdown').classList.add('hidden');
        }

        async function resetForm() {
            document.getElementById('studentForm').reset();
            
            // Reset middle name field properly
            resetMiddleNameField();
            
            // Reset character counters
            updateCounter('lastName', 'lastNameCounter', 50);
            updateCounter('firstName', 'firstNameCounter', 50);
            updateCounter('middleName', 'middleNameCounter', 50);
            updateCounter('address', 'addressCounter', 200);
            
            // Generate new student ID
            await setAutoGeneratedId();
        }

        function toggleMiddleName() {
            const checkbox = document.getElementById('hasMiddleName');
            const middleNameField = document.getElementById('middleName');
            
            if (checkbox.checked) {
                middleNameField.disabled = false;
                middleNameField.classList.remove('bg-gray-100', 'cursor-not-allowed');
                middleNameField.classList.add('focus:outline-none', 'focus:ring-2', 'focus:ring-blue-500');
            } else {
                middleNameField.disabled = true;
                middleNameField.value = '';
                middleNameField.classList.add('bg-gray-100', 'cursor-not-allowed');
                middleNameField.classList.remove('focus:ring-2', 'focus:ring-blue-500');
                updateCounter('middleName', 'middleNameCounter', 50);
            }
        }

        let currentYearFilter = null;
        let isTableHidden = false;

        function filterByYear(yearLevel) {
            const tableContainer = document.getElementById('studentTableContainer');
            const buttons = ['btn1st', 'btn2nd', 'btn3rd', 'btn4th', 'btnAll'];
            
            // Reset all button styles
            buttons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('bg-blue-100', 'text-blue-900');
            });
            
            // Prevent camera movement by maintaining scroll position
            const scrollPosition = window.pageYOffset;
            
            // If clicking the same year button, toggle hide/show
            if (currentYearFilter === yearLevel) {
                if (isTableHidden) {
                    tableContainer.classList.remove('hidden');
                    isTableHidden = false;
                } else {
                    // Use opacity instead of display:none to maintain layout
                    tableContainer.style.opacity = '0';
                    setTimeout(() => {
                        tableContainer.classList.add('hidden');
                        tableContainer.style.opacity = '';
                    }, 200);
                    isTableHidden = true;
                }
            } else {
                // Show table and filter by year
                tableContainer.classList.remove('hidden');
                tableContainer.style.opacity = '';
                isTableHidden = false;
                currentYearFilter = yearLevel;
                
                // Highlight active button
                const activeBtn = document.getElementById(`btn${yearLevel.split(' ')[0].toLowerCase()}`);
                activeBtn.classList.remove('bg-blue-100', 'text-blue-900');
                activeBtn.classList.add('bg-blue-500', 'text-white');
                
                // Filter students
                const filteredStudents = allStudents.filter(student => student.yearLevel === yearLevel);
                displayStudents(filteredStudents);
            }
            
            // Restore scroll position to prevent camera movement
            window.scrollTo(0, scrollPosition);
        }

        function showAllYears() {
            const tableContainer = document.getElementById('studentTableContainer');
            const buttons = ['btn1st', 'btn2nd', 'btn3rd', 'btn4th', 'btnAll'];
            
            // Prevent camera movement by maintaining scroll position
            const scrollPosition = window.pageYOffset;
            
            // Reset all button styles
            buttons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                btn.classList.remove('bg-blue-500', 'text-white', 'bg-gray-500');
                if (btnId === 'btnAll') {
                    btn.classList.add('bg-gray-500', 'text-white');
                } else {
                    btn.classList.add('bg-blue-100', 'text-blue-900');
                }
            });
            
            // Show table and display all students
            tableContainer.classList.remove('hidden');
            tableContainer.style.opacity = '';
            isTableHidden = false;
            currentYearFilter = null;
            displayStudents(allStudents);
            
            // Restore scroll position to prevent camera movement
            window.scrollTo(0, scrollPosition);
        }

        // Remove old subject modal code since we're now using database data

        function openEditAddressModal() {
            document.getElementById('addressModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Set flag to know we're editing
            document.getElementById('addressModal').setAttribute('data-edit-mode', 'true');
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            const dropdowns = ['regionDropdown', 'provinceDropdown', 'municipalityDropdown', 'barangayDropdown'];
            const buttons = ['toggleRegionDropdown', 'toggleProvinceDropdown', 'toggleMunicipalityDropdown', 'toggleBarangayDropdown'];
            
            dropdowns.forEach((dropdownId, index) => {
                const dropdown = document.getElementById(dropdownId);
                const isClickOnButton = event.target.closest(`button[onclick="${buttons[index]}()"]`);
                const isClickInDropdown = event.target.closest(`#${dropdownId}`);
                
                if (!isClickOnButton && !isClickInDropdown) {
                    dropdown.classList.add('hidden');
                }
            });
        });
    </script>



    <!-- Footer -->
    <footer class="bg-gradient-to-r from-blue-600 via-blue-700 to-orange-500 text-white py-4">
        <div class="max-w-7xl mx-auto text-center">
            <p class="text-sm">
                © 2025 w3bforge BCC. All rights reserved.
            </p>
        </div>
    </footer>
</body>
</html>