<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> W3bforge BCC System </title>
    <link rel="icon" type="image/png" href="images/BCLOGO.png">
    <link rel="shortcut icon" type="image/png" href="images/BCLOGO.png">
    <link rel="apple-touch-icon" href="images/BCLOGO.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Prevent camera movement when filtering students */
        #studentTableContainer {
            min-height: 400px;
            transition: opacity 0.2s ease-in-out;
        }
        
        /* Smooth transitions for table visibility */
        #studentTableContainer.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        /* Ensure consistent button heights */
        .year-filter-btn {
            height: 44px;
            min-width: 80px;
        }
        
        /* Enhanced Logo Styling */
        .logo-enhanced {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #e2e8f0 100%);
            border: 2px solid rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 8px;
            box-shadow: 
                0 4px 6px rgba(0, 0, 0, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .logo-enhanced::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.6s ease;
            opacity: 0;
        }
        
        .logo-enhanced:hover {
            transform: translateY(-2px) scale(1.1) rotate(3deg);
            border-color: #fbbf24;
            box-shadow: 
                0 12px 25px rgba(251, 191, 36, 0.3),
                0 6px 12px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 50%, #fde68a 100%);
        }
        
        .logo-enhanced:hover::before {
            animation: logoShimmer 1.2s ease-in-out;
        }
        
        .logo-enhanced:active {
            transform: translateY(1px) scale(1.05);
        }
        
        @keyframes logoShimmer {
            0% {
                opacity: 0;
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }
        
        /* Cool W3BFORGE BCC title styling - Compact version */
        .brand-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            font-weight: 900;
            letter-spacing: 0.3px;
            text-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
            position: relative;
            transition: all 0.3s ease;
        }
        
        .brand-title::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            border-radius: 12px;
            opacity: 0.1;
            z-index: -1;
            transition: opacity 0.3s ease;
        }
        
        .brand-title:hover {
            transform: translateY(-1px);
            filter: drop-shadow(0 4px 8px rgba(102, 126, 234, 0.4));
        }
        
        .brand-title:hover::before {
            opacity: 0.2;
        }
        
        .brand-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 8px;
            padding: 4px 12px;
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.05),
                0 6px 12px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .brand-container::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.6s ease;
            opacity: 0;
        }
        
        .brand-container:hover::after {
            animation: shimmer 1.5s ease-in-out;
        }
        
        .brand-container:hover {
            transform: translateY(-1px);
            box-shadow: 
                0 6px 20px rgba(102, 126, 234, 0.12),
                0 12px 25px rgba(118, 75, 162, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
        }
        
        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        /* Enhanced Navbar Styling */
        nav {
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            background: linear-gradient(135deg, 
                rgba(79, 70, 229, 0.95) 0%, 
                rgba(59, 130, 246, 0.95) 50%, 
                rgba(147, 51, 234, 0.95) 100%);
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 4px 6px rgba(0, 0, 0, 0.1),
                0 1px 3px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        /* Dropdown enhanced styling */
        #dropdown {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.95) 0%, 
                rgba(239, 246, 255, 0.95) 50%, 
                rgba(224, 231, 255, 0.95) 100%);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 2px solid rgba(79, 70, 229, 0.2);
            box-shadow: 
                0 20px 25px -5px rgba(0, 0, 0, 0.1),
                0 10px 10px -5px rgba(0, 0, 0, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }
        
        /* Name validation warning styling */
        .validation-warning {
            animation: warningFadeIn 0.3s ease-out;
            z-index: 20;
        }
        
        @keyframes warningFadeIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Enhanced input error state */
        .name-field-error {
            border-color: #ef4444 !important;
            background: linear-gradient(to right, #fef2f2, #fee2e2) !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }
        
        /* Delete modal animations */
        #deleteModal {
            backdrop-filter: blur(4px);
        }
        
        #deleteModal .bg-gradient-to-br {
            animation: deleteModalSlideIn 0.3s ease-out;
        }
        
        @keyframes deleteModalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* Edit modal animations */
        #editModal {
            backdrop-filter: blur(6px);
        }
        
        #editModal .bg-gradient-to-br {
            animation: editModalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes editModalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-80px) scale(0.8) rotate(1deg);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1) rotate(0deg);
            }
        }
        
        /* Status modal animations */
        #statusModal {
            backdrop-filter: blur(5px);
        }
        
        #statusModal .bg-gradient-to-br {
            animation: statusModalSlideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes statusModalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-60px) scale(0.7) rotateX(10deg);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1) rotateX(0deg);
            }
        }
        
        /* Filter panel animations */
        #filterSidePanel {
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #filterSidePanel.translate-x-0 {
            animation: filterSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes filterSlideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Filter form field animations */
        #filterSidePanel input:focus,
        #filterSidePanel select:focus {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }
        
        /* Filter card hover effects */
        #filterSidePanel > div > div > div {
            transition: all 0.3s ease;
        }
        
        #filterSidePanel > div > div > div:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
        }
        
        /* Status option hover effects */
        #statusModal label {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #statusModal label:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        /* Enhanced form field animations */
        #editModal input:focus,
        #editModal select:focus,
        #editModal textarea:focus {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }
        
        /* Character counter enhanced styling */
        #editModal .absolute span {
            transition: all 0.3s ease;
        }
        
        #editModal input:focus + span,
        #editModal textarea:focus + span {
            transform: scale(1.1);
            font-weight: 800;
        }
        
        /* Button hover enhancements */
        #editModal button:hover,
        #statusModal button:hover {
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        /* Warning icon pulse animation */
        .animate-pulse {
            animation: warningPulse 2s ease-in-out infinite;
        }
        
        @keyframes warningPulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }
        
        @keyframes shimmer {
            0% {
                opacity: 0;
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }
        #successModal {
            backdrop-filter: blur(4px);
        }
        
        #successModal .bg-gradient-to-br {
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* Success icon pulse animation */
        .success-icon {
            animation: successPulse 1s ease-in-out;
        }
        
        @keyframes successPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-orange-50 to-blue-100">
    <!-- Navigation Bar -->
    <nav class="fixed top-0 left-0 right-0 bg-gradient-to-r from-indigo-600 via-blue-500 to-purple-600 px-3 py-1.5 shadow-xl border-b-2 border-indigo-300 z-40 backdrop-blur-md">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <img src="images/BCLOGO.png" alt="GCBC Logo" class="h-10 w-10 object-contain cursor-pointer logo-enhanced" onclick="showSection('students')">
                <div class="brand-container">
                    <h1 class="brand-title text-sm font-black">W3BFORGE BCC</h1>
                </div>
            </div>
            <div class="relative">
                <button onclick="toggleDropdown()" class="flex items-center space-x-1 text-white hover:text-yellow-300 transition duration-200 font-bold text-sm tracking-wide px-3 py-1.5 rounded-lg bg-white bg-opacity-10 hover:bg-opacity-20 backdrop-blur-sm">
                    <span class="font-serif">MENU</span>
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                <div id="dropdown" class="hidden absolute right-0 mt-2 w-52 bg-gradient-to-b from-white via-blue-50 to-indigo-50 rounded-xl shadow-2xl z-50 border-2 border-indigo-200 backdrop-blur-md">
                    <a href="#" onclick="showSection('students'); closeDropdown()" class="block px-4 py-3 text-indigo-800 hover:bg-indigo-100 hover:text-purple-700 transition duration-200 font-semibold tracking-wide rounded-t-xl border-b border-indigo-100">📚 Student Masterlist</a>
                    <a href="#" onclick="showSection('grading'); closeDropdown()" class="block px-4 py-3 text-indigo-800 hover:bg-purple-100 hover:text-indigo-700 transition duration-200 font-semibold tracking-wide border-b border-indigo-100">📊 Grading Remarks</a>
                    <a href="#" onclick="showSection('classrecord'); closeDropdown()" class="block px-4 py-3 text-indigo-800 hover:bg-indigo-100 hover:text-purple-700 transition duration-200 font-semibold tracking-wide border-b border-indigo-100">📋 Class Record</a>
                    <a href="#" onclick="showSection('syllabus'); closeDropdown()" class="block px-4 py-3 text-indigo-800 hover:bg-purple-100 hover:text-indigo-700 rounded-b-xl transition duration-200 font-semibold tracking-wide">📖 Curriculum</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto p-4 sm:p-6 mt-12">
        <!-- Student Masterlist Section -->
        <div id="studentsSection">
            <h1 class="text-3xl sm:text-4xl font-bold text-center mb-6 sm:mb-8 text-gray-900">Student Masterlist</h1>
            
            <div class="grid grid-cols-1 gap-6 sm:gap-8">
                <!-- Add Student Form (Top) -->
                <div class="bg-gradient-to-r from-orange-50 to-blue-50 rounded-lg shadow-md p-4 sm:p-6 border border-orange-200">
                    <h2 class="text-xl sm:text-2xl font-bold mb-4 text-gray-800">Add New Student</h2>
                    <form id="studentForm" autocomplete="off" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                        <div>
                            <div class="flex items-center space-x-2 mb-2">
                                <label class="block text-base font-bold text-gray-900">Student ID</label>
                                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-semibold" title="System automatically fills gaps when students are deleted">📋 Smart Auto-ID</span>
                            </div>
                            <input type="text" id="studentId" required readonly class="w-full px-4 py-3 text-base border-2 border-gray-400 rounded-md bg-gray-100 cursor-not-allowed focus:outline-none" placeholder="Auto-generated (fills gaps intelligently)">
                        </div>
                        <div>
                            <div class="flex items-center space-x-2 mb-2">
                                <label class="block text-base font-bold text-gray-900">Last Name</label>
                                <span class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full font-semibold" title="Only letters, spaces, hyphens, and apostrophes allowed">🚫 No Numbers</span>
                            </div>
                            <div class="relative">
                                <input type="text" id="lastName" required maxlength="50" autocomplete="off" class="w-full px-4 py-3 pr-16 text-base border-2 border-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" oninput="validateNameField('lastName', 'lastNameCounter', 50)">
                                <span id="lastNameCounter" class="absolute right-3 top-3 text-sm font-semibold text-gray-600">0/50</span>
                            </div>
                        </div>
                        <div>
                            <div class="flex items-center space-x-2 mb-2">
                                <label class="block text-base font-bold text-gray-900">First Name</label>
                                <span class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full font-semibold" title="Only letters, spaces, hyphens, and apostrophes allowed">🚫 No Numbers</span>
                            </div>
                            <div class="relative">
                                <input type="text" id="firstName" required maxlength="50" autocomplete="off" class="w-full px-4 py-3 pr-16 text-base border-2 border-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" oninput="validateNameField('firstName', 'firstNameCounter', 50)">
                                <span id="firstNameCounter" class="absolute right-3 top-3 text-sm font-semibold text-gray-600">0/50</span>
                            </div>
                        </div>
                        <div>
                            <div class="flex items-center space-x-3 mb-2">
                                <label class="block text-base font-bold text-gray-900">Middle Name</label>
                                <input type="checkbox" id="hasMiddleName" onchange="toggleMiddleName()" class="rounded w-4 h-4">
                                <span class="text-sm font-semibold text-gray-700">Has middle name</span>
                                <span class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full font-semibold" title="Only letters, spaces, hyphens, and apostrophes allowed">🚫 No Numbers</span>
                            </div>
                            <div class="relative">
                                <input type="text" id="middleName" maxlength="50" autocomplete="off" disabled class="w-full px-4 py-3 pr-16 text-base border-2 border-gray-400 rounded-md bg-gray-100 cursor-not-allowed focus:outline-none" oninput="validateNameField('middleName', 'middleNameCounter', 50)">
                                <span id="middleNameCounter" class="absolute right-3 top-3 text-sm font-semibold text-gray-600">0/50</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-base font-bold text-gray-900 mb-2">Course</label>
                            <select id="course" required autocomplete="off" class="w-full px-4 py-3 text-base border-2 border-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select Course</option>
                                <option value="BSIT">BSIT</option>
                                <option value="BMMA">BMMA</option>
                                <option value="CUSTOM">CUSTOM</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-base font-bold text-gray-900 mb-2">Year Level</label>
                            <select id="yearLevel" required autocomplete="off" class="w-full px-4 py-3 text-base border-2 border-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select Year Level</option>
                                <option value="1st Year">1st Year</option>
                                <option value="2nd Year">2nd Year</option>
                                <option value="3rd Year">3rd Year</option>
                                <option value="4th Year">4th Year</option>
                            </select>
                        </div>
                        <div class="md:col-span-2 lg:col-span-3">
                            <div class="flex items-center space-x-3 mb-2">
                                <label class="block text-base font-bold text-gray-900">Address</label>
                                <button type="button" onclick="openAddressModal()" class="bg-blue-100 hover:bg-blue-200 border-2 border-blue-400 rounded px-3 py-2 text-sm font-semibold hover:scale-105 transition-all duration-200" title="Address Helper">
                                    ❓
                                </button>
                            </div>
                            <div class="relative">
                                <textarea id="address" required rows="3" maxlength="200" autocomplete="off" disabled class="w-full px-4 py-3 pr-20 text-base border-2 border-gray-400 rounded-md bg-gray-100 cursor-not-allowed" oninput="updateCounter('address', 'addressCounter', 200)"></textarea>
                                <span id="addressCounter" class="absolute right-3 top-3 text-sm font-semibold text-gray-600">0/200</span>
                            </div>
                        </div>
                        <div class="md:col-span-2 lg:col-span-3 flex space-x-4 mt-4">
                            <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 text-base rounded-md transition duration-200">
                                Add Student
                            </button>
                            <button type="button" onclick="resetForm()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 text-base rounded-md transition duration-200">
                                Reset
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Student List (Bottom) -->
                <div class="bg-gradient-to-r from-blue-50 to-orange-50 rounded-lg shadow-md p-4 sm:p-6 border border-blue-200">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl sm:text-2xl font-bold text-gray-800">Student List</h2>
                        <button onclick="toggleFilters()" class="text-xl sm:text-2xl hover:scale-110 transition-transform duration-200" title="Filters">
                            ⚙️
                        </button>
                    </div>
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button onclick="filterByYear('1st Year')" id="btn1st" class="year-filter-btn px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold rounded text-base transition duration-200">1st Year</button>
                        <button onclick="filterByYear('2nd Year')" id="btn2nd" class="year-filter-btn px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold rounded text-base transition duration-200">2nd Year</button>
                        <button onclick="filterByYear('3rd Year')" id="btn3rd" class="year-filter-btn px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold rounded text-base transition duration-200">3rd Year</button>
                        <button onclick="filterByYear('4th Year')" id="btn4th" class="year-filter-btn px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold rounded text-base transition duration-200">4th Year</button>
                        <button onclick="showAllYears()" id="btnAll" class="year-filter-btn px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-900 font-semibold rounded text-base transition duration-200">Show All</button>
                    </div>
                    <div class="student-table-wrapper">
                        <div id="studentTableContainer" class="overflow-x-auto">
                        <table class="w-full table-auto border-collapse border border-gray-300">
                            <thead>
                                <tr class="bg-gradient-to-r from-blue-100 to-orange-100">
                                    <th class="px-2 sm:px-3 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-16">No.</th>
                                    <th class="px-2 sm:px-3 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-24 cursor-pointer hover:bg-blue-200" ondblclick="toggleIdSort()" title="Double-click to sort">ID ↕️</th>
                                    <th class="px-2 sm:px-3 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-32">Last Name</th>
                                    <th class="px-2 sm:px-3 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-32">First Name</th>
                                    <th class="px-2 sm:px-3 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-20">Course</th>
                                    <th class="px-2 sm:px-3 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-28">Year Level</th>
                                    <th class="px-2 sm:px-3 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-32">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="studentTableBody">
                                <!-- Students will be added here -->
                            </tbody>
                        </table>
                    </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Class Record Section -->
        <div id="classrecordSection" class="hidden">
            <h1 class="text-3xl sm:text-4xl font-bold text-center mb-6 sm:mb-8 text-gray-900">Class Record</h1>
            
            <div class="grid grid-cols-1 gap-6 sm:gap-8">
                <!-- Add Subject Form -->
                <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg shadow-md p-4 sm:p-6 border border-purple-200">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl sm:text-2xl font-bold text-gray-800">Subject Management</h2>
                        <button onclick="openAddSubjectModal()" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg">
                            <span class="flex items-center text-base">
                                📚 <span class="ml-2">Add New Subject</span>
                            </span>
                        </button>
                    </div>
                    <div class="bg-white rounded-lg p-4 border border-gray-200 min-h-32">
                        <p class="text-center text-gray-600 italic">Click "Add New Subject" to start managing your class subjects.</p>
                    </div>
                </div>
                
                <!-- Subjects List -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg shadow-md p-4 sm:p-6 border border-blue-200">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4">Current Subjects</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto border-collapse border border-gray-300">
                            <thead>
                                <tr class="bg-gradient-to-r from-blue-100 to-purple-100">
                                    <th class="px-4 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-16">No.</th>
                                    <th class="px-4 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-32">Subject Code</th>
                                    <th class="px-4 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300">Subject Title</th>
                                    <th class="px-4 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-24">Units</th>
                                    <th class="px-4 py-3 text-left text-sm font-bold text-gray-900 border border-gray-300 w-32">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="subjectsTableBody">
                                <tr>
                                    <td colspan="5" class="px-4 py-8 text-center text-gray-500 border border-gray-300">No subjects added yet. Click "Add New Subject" to get started.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Syllabus Section -->
        <div id="syllabusSection" class="hidden">
            <h1 class="text-3xl sm:text-4xl font-bold text-center mb-6 sm:mb-8 text-gray-900">Curriculum</h1>
            <div class="bg-gradient-to-r from-blue-50 to-orange-50 rounded-lg shadow-md p-8 border border-blue-200 min-h-96">
                <p class="text-center text-gray-600">Curriculum content will be available soon.</p>
            </div>
        </div>

        <!-- Grading Period Section -->
        <div id="gradingSection" class="hidden">
            <h1 class="text-3xl sm:text-4xl font-bold text-center mb-6 sm:mb-8 text-gray-900">Grading Remarks</h1>
            
            <div class="flex mb-6 sm:mb-8">
                <div class="bg-gradient-to-br from-slate-50 via-white to-indigo-50 rounded-2xl shadow-xl p-6 border-2 border-slate-200 mr-6 backdrop-blur-sm">
                    <div class="flex flex-col space-y-6">
                        <!-- Prelim Icon -->
                        <div id="prelim-icon" class="text-center transition-all duration-500">
                            <button onclick="showGradingGrid('prelim')" class="flex flex-col items-center justify-center w-16 h-16 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 group">
                                <svg class="w-7 h-7 group-hover:scale-110 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                </svg>
                            </button>
                            <p class="mt-3 text-sm font-bold text-gray-700 tracking-wide">PRELIM</p>
                        </div>
                        
                        <!-- Midterm Icon -->
                        <div id="midterm-icon" class="text-center transition-all duration-500">
                            <button onclick="showGradingGrid('midterm')" class="flex flex-col items-center justify-center w-16 h-16 rounded-xl bg-gradient-to-br from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 group">
                                <svg class="w-7 h-7 group-hover:scale-110 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </button>
                            <p class="mt-3 text-sm font-bold text-gray-700 tracking-wide">MIDTERM</p>
                        </div>
                        
                        <!-- Finals Icon -->
                        <div id="finals-icon" class="text-center transition-all duration-500">
                            <button onclick="showGradingGrid('finals')" class="flex flex-col items-center justify-center w-16 h-16 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 group">
                                <svg class="w-7 h-7 group-hover:scale-110 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                                </svg>
                            </button>
                            <p class="mt-3 text-sm font-bold text-gray-700 tracking-wide">FINALS</p>
                        </div>
                    </div>
                </div>
                <!-- Grading Grid -->
                <div id="gradingGrid" class="hidden flex-1">
                    <div class="bg-gradient-to-br from-white via-slate-50 to-indigo-50 rounded-2xl shadow-xl p-8 border-2 border-slate-200 backdrop-blur-sm">
                        <div class="overflow-x-auto">
                            <table class="w-full table-auto">
                                <thead>
                                    <tr class="bg-gradient-to-r from-slate-100 via-blue-50 to-indigo-100 border-b-2 border-slate-300">
                                        <th class="px-6 py-4 text-left text-sm font-black text-slate-700 tracking-wide">NO.</th>
                                        <th class="px-6 py-4 text-left text-sm font-black text-slate-700 tracking-wide">STUDENT ID</th>
                                        <th class="px-6 py-4 text-left text-sm font-black text-slate-700 tracking-wide">FULL NAME</th>
                                        <th class="px-6 py-4 text-left text-sm font-black text-slate-700 tracking-wide">FINAL GRADE</th>
                                        <th class="px-6 py-4 text-left text-sm font-black text-slate-700 tracking-wide">REMARKS</th>
                                    </tr>
                                </thead>
                                <tbody id="gradingTableBody">
                                    <!-- Grading data will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Side Panel -->
    <div id="filterSidePanel" class="fixed top-0 right-0 h-full w-full sm:w-80 bg-gradient-to-br from-purple-50 via-white to-blue-50 shadow-2xl transform translate-x-full transition-all duration-500 ease-in-out z-[70] border-l-4 border-purple-300 backdrop-blur-sm">
        <div class="h-full flex flex-col">
            <!-- Enhanced Header -->
            <div class="bg-gradient-to-r from-purple-600 to-blue-600 p-6 text-white">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="flex items-center justify-center h-12 w-12 rounded-full bg-white bg-opacity-20 backdrop-blur-sm">
                            <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-2xl font-black tracking-wide"> FILTERS</h3>
                            <p class="text-sm text-purple-100 font-semibold">Refine your student search</p>
                        </div>
                    </div>
                    <button onclick="closeFilters()" class="text-white hover:text-purple-200 text-3xl font-bold transition-all duration-200 hover:scale-110 hover:rotate-90">×</button>
                </div>
            </div>
            
            <!-- Filter Content -->
            <div class="flex-1 p-6 space-y-6 overflow-y-auto">
                <!-- Status Filter -->
                <div class="bg-gradient-to-r from-green-50 to-yellow-50 rounded-xl p-5 border-2 border-green-200 shadow-lg">
                    <label class="flex items-center space-x-2 text-lg font-black text-gray-900 mb-4">
                        <svg class="h-5 w-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span> Status Filter</span>
                    </label>
                    <select id="statusFilter" autocomplete="off" class="w-full px-4 py-3 text-base font-bold border-2 border-green-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-green-200 focus:border-green-500 bg-gradient-to-r from-white to-green-50 transition-all duration-200 hover:shadow-lg">
                        <option value="" class="font-semibold">All Status</option>
                        <option value="ACTIVE" class="font-semibold text-green-700">✅ Active Students</option>
                        <option value="PENDING" class="font-semibold text-yellow-700">⏳ Pending Students</option>
                    </select>
                </div>
                
                <!-- Student ID Search -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-5 border-2 border-blue-200 shadow-lg">
                    <label class="flex items-center space-x-2 text-lg font-black text-gray-900 mb-4">
                        <svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 21h7a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v11m0 5l4.5-4.5M21 3l-6 6"></path>
                        </svg>
                        <span> Student ID Search</span>
                    </label>
                    <input type="text" id="searchId" placeholder="Enter Student ID (e.g., 25-0000001)" autocomplete="off" class="w-full px-4 py-3 text-base font-semibold border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-blue-200 focus:border-blue-500 bg-gradient-to-r from-white to-blue-50 transition-all duration-200 hover:shadow-lg placeholder-blue-400">
                </div>
                
                <!-- Name Search -->
                <div class="bg-gradient-to-r from-pink-50 to-purple-50 rounded-xl p-5 border-2 border-pink-200 shadow-lg">
                    <label class="flex items-center space-x-2 text-lg font-black text-gray-900 mb-4">
                        <svg class="h-5 w-5 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span> Name Search</span>
                    </label>
                    <input type="text" id="searchName" placeholder="Last Name or First Name" autocomplete="off" class="w-full px-4 py-3 text-base font-semibold border-2 border-pink-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-pink-200 focus:border-pink-500 bg-gradient-to-r from-white to-pink-50 transition-all duration-200 hover:shadow-lg placeholder-pink-400">
                </div>
                
                <!-- Course Filter -->
                <div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-xl p-5 border-2 border-orange-200 shadow-lg">
                    <label class="flex items-center space-x-2 text-lg font-black text-gray-900 mb-4">
                        <svg class="h-5 w-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                        <span> Course Filter</span>
                    </label>
                    <select id="courseSort" autocomplete="off" class="w-full px-4 py-3 text-base font-bold border-2 border-orange-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-orange-200 focus:border-orange-500 bg-gradient-to-r from-white to-orange-50 transition-all duration-200 hover:shadow-lg">
                        <option value="" class="font-semibold">All Courses</option>
                    </select>
                </div>
                
                <!-- Sort Options -->
                <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-5 border-2 border-indigo-200 shadow-lg">
                    <label class="flex items-center space-x-2 text-lg font-black text-gray-900 mb-4">
                        <svg class="h-5 w-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h9m5-4v12m0 0l-4-4m4 4l4-4"></path>
                        </svg>
                        <span> Sort by ID</span>
                    </label>
                    <select id="idSort" autocomplete="off" class="w-full px-4 py-3 text-base font-bold border-2 border-indigo-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-500 bg-gradient-to-r from-white to-indigo-50 transition-all duration-200 hover:shadow-lg">
                        <option value="" class="font-semibold">Default Order</option>
                        <option value="asc" class="font-semibold">⬆️ Lowest to Highest</option>
                        <option value="desc" class="font-semibold">⬇️ Highest to Lowest</option>
                    </select>
                </div>
                
                <!-- Clear Filters Button -->
                <div class="pt-4">
                    <button onclick="clearAllFilters()" class="w-full bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-gray-300 transform hover:scale-105 shadow-xl">
                        <span class="flex items-center justify-center text-lg">
                            🗑️ <span class="ml-2">CLEAR ALL FILTERS</span>
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Overlay -->
    <div id="filterOverlay" class="fixed inset-0 bg-black bg-opacity-60 hidden z-[65] backdrop-blur-sm" onclick="closeFilters()"></div>

    <!-- Address Modal -->
    <div id="addressModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]">
        <div class="bg-gradient-to-br from-blue-50 to-orange-50 rounded-lg shadow-lg p-6 w-96 max-w-md mx-4 border border-blue-200">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold text-gray-700">Address Helper</h2>
                <button onclick="closeAddressModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
            </div>
            <div class="space-y-3">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Country</label>
                    <input type="text" id="country" value="PHL" readonly class="w-full px-3 py-2 border border-gray-300 rounded bg-gray-100 cursor-not-allowed focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Region</label>
                    <div class="relative">
                        <input type="text" id="region" readonly class="w-full px-3 py-2 pr-10 border border-gray-300 rounded bg-gray-100 cursor-not-allowed focus:outline-none">
                        <button type="button" onclick="toggleRegionDropdown()" class="absolute right-2 top-2 bg-blue-100 hover:bg-blue-200 border border-blue-300 rounded px-2 py-1 text-sm hover:scale-105 transition-all duration-200" title="Select Region">
                            📍
                        </button>
                        <div id="regionDropdown" class="hidden absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded shadow-lg max-h-48 overflow-y-auto z-30">
                            <button type="button" onclick="selectRegion('NCR')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">NCR - National Capital Region</button>
                            <button type="button" onclick="selectRegion('CAR')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">CAR - Cordillera Administrative Region</button>
                            <button type="button" onclick="selectRegion('Region I')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region I - Ilocos Region</button>
                            <button type="button" onclick="selectRegion('Region II')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region II - Cagayan Valley</button>
                            <button type="button" onclick="selectRegion('Region III')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region III - Central Luzon</button>
                            <button type="button" onclick="selectRegion('Region IV-A')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region IV-A - CALABARZON</button>
                            <button type="button" onclick="selectRegion('Region IV-B')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region IV-B - MIMAROPA</button>
                            <button type="button" onclick="selectRegion('Region V')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region V - Bicol Region</button>
                            <button type="button" onclick="selectRegion('Region VI')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region VI - Western Visayas</button>
                            <button type="button" onclick="selectRegion('Region VII')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region VII - Central Visayas</button>
                            <button type="button" onclick="selectRegion('Region VIII')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region VIII - Eastern Visayas</button>
                            <button type="button" onclick="selectRegion('Region IX')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region IX - Zamboanga Peninsula</button>
                            <button type="button" onclick="selectRegion('Region X')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region X - Northern Mindanao</button>
                            <button type="button" onclick="selectRegion('Region XI')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region XI - Davao Region</button>
                            <button type="button" onclick="selectRegion('Region XII')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region XII - SOCCSKSARGEN</button>
                            <button type="button" onclick="selectRegion('Region XIII')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">Region XIII - Caraga</button>
                            <button type="button" onclick="selectRegion('BARMM')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">BARMM - Bangsamoro Autonomous Region</button>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Province</label>
                    <div class="relative">
                        <input type="text" id="province" readonly class="w-full px-3 py-2 pr-10 border border-gray-300 rounded bg-gray-100 cursor-not-allowed focus:outline-none">
                        <button type="button" onclick="toggleProvinceDropdown()" class="absolute right-2 top-2 bg-blue-100 hover:bg-blue-200 border border-blue-300 rounded px-2 py-1 text-sm hover:scale-105 transition-all duration-200" title="Select Province">
                            📍
                        </button>
                        <div id="provinceDropdown" class="hidden absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded shadow-lg max-h-48 overflow-y-auto z-30">
                            <div id="provinceList" class="text-center py-4 text-gray-500">Please select a region first</div>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Municipality</label>
                    <div class="relative">
                        <input type="text" id="municipality" readonly class="w-full px-3 py-2 pr-10 border border-gray-300 rounded bg-gray-100 cursor-not-allowed focus:outline-none">
                        <button type="button" onclick="toggleMunicipalityDropdown()" class="absolute right-2 top-2 bg-blue-100 hover:bg-blue-200 border border-blue-300 rounded px-2 py-1 text-sm hover:scale-105 transition-all duration-200" title="Select Municipality">
                            📍
                        </button>
                        <div id="municipalityDropdown" class="hidden absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded shadow-lg max-h-48 overflow-y-auto z-30">
                            <div id="municipalityList" class="text-center py-4 text-gray-500">Please select a province first</div>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Barangay</label>
                    <div class="relative">
                        <input type="text" id="barangay" readonly class="w-full px-3 py-2 pr-10 border border-gray-300 rounded bg-gray-100 cursor-not-allowed focus:outline-none">
                        <button type="button" onclick="toggleBarangayDropdown()" class="absolute right-2 top-2 bg-blue-100 hover:bg-blue-200 border border-blue-300 rounded px-2 py-1 text-sm hover:scale-105 transition-all duration-200" title="Select Barangay">
                            📍
                        </button>
                        <div id="barangayDropdown" class="hidden absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded shadow-lg max-h-48 overflow-y-auto z-30">
                            <div id="barangayList" class="text-center py-4 text-gray-500">Please select a municipality first</div>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Street Address</label>
                    <input type="text" id="streetAddress" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                </div>
                <div class="flex space-x-3 mt-4">
                    <button onclick="generateAddress()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded transition duration-200">
                        Generate Address
                    </button>
                    <button onclick="closeAddressModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded transition duration-200">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Popup Modal -->
    <div id="successModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70]">
        <div class="bg-gradient-to-br from-green-50 to-blue-50 rounded-lg shadow-xl p-6 w-96 max-w-md mx-4 border-2 border-green-300 transform transition-all duration-300 scale-95">
            <div class="text-center">
                <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4 success-icon">
                    <svg class="h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">Student Added Successfully!</h3>
                <div id="successMessage" class="text-base font-semibold text-gray-700 mb-6">
                    <!-- Success message will be inserted here -->
                </div>
                <button onclick="closeSuccessModal()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-md transition duration-200 focus:outline-none focus:ring-2 focus:ring-green-500">
                    OK
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[60]">
        <div class="bg-gradient-to-br from-red-50 via-white to-red-100 rounded-xl shadow-2xl p-8 w-[480px] max-w-md mx-4 border-2 border-red-400 transform transition-all duration-300 scale-95 backdrop-blur-sm">
            <div class="text-center">
                <!-- Enhanced Warning Icon -->
                <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-gradient-to-br from-red-100 to-red-200 mb-6 animate-pulse shadow-lg border-4 border-red-300">
                    <svg class="h-10 w-10 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                    </svg>
                </div>
                
                <!-- Title with Enhanced Styling -->
                <h3 class="text-2xl font-black text-gray-900 mb-4 tracking-wide">⚠️ CONFIRM DELETE</h3>
                
                <!-- Student Information Container -->
                <div id="deleteStudentInfo" class="text-base font-semibold text-gray-700 mb-6">
                    <!-- Student info will be inserted here -->
                </div>
                
                <!-- Enhanced Warning Message -->
                <div class="bg-gradient-to-r from-red-100 to-orange-100 border-2 border-red-300 rounded-lg p-4 mb-6">
                    <p class="text-base text-red-700 font-bold flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2 animate-pulse" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                        </svg>
                        This action cannot be undone!
                    </p>
                    <p class="text-sm text-red-600 mt-2">The student record will be permanently removed from the database.</p>
                </div>
                
                <!-- Enhanced Action Buttons -->
                <div class="flex space-x-4">
                    <button onclick="confirmDelete()" class="flex-1 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-bold py-4 px-6 rounded-lg transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-red-300 transform hover:scale-105 shadow-lg">
                        <span class="flex items-center justify-center">
                            🗑️ <span class="ml-2">DELETE STUDENT</span>
                        </span>
                    </button>
                    <button onclick="closeDeleteModal()" class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-4 px-6 rounded-lg transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-gray-300 transform hover:scale-105 shadow-lg">
                        <span class="flex items-center justify-center">
                            ❌ <span class="ml-2">CANCEL</span>
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div id="editModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
        <div class="bg-gradient-to-br from-blue-50 via-white to-purple-50 rounded-2xl shadow-2xl p-8 w-full max-w-4xl mx-4 border-2 border-blue-300 max-h-[90vh] overflow-y-auto backdrop-blur-sm transform transition-all duration-300 scale-95">
            <!-- Enhanced Header with Icon -->
            <div class="text-center mb-8">
                <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-gradient-to-br from-blue-100 to-purple-100 mb-4 shadow-lg border-4 border-blue-300">
                    <svg class="h-8 w-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                </div>
                <h2 class="text-3xl font-black text-gray-900 mb-2 tracking-wide">✏️ EDIT STUDENT</h2>
                <p class="text-base text-gray-600 font-semibold">Update student information below</p>
            </div>
            
            <form id="editForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Student ID Field -->
                <div class="md:col-span-2">
                    <div class="flex items-center space-x-2 mb-3">
                        <label class="block text-base font-bold text-gray-900">📋 Student ID</label>
                        <span class="text-xs bg-gray-100 text-gray-700 px-3 py-1 rounded-full font-semibold">🔒 Read-only</span>
                    </div>
                    <input type="text" id="editStudentId" disabled class="w-full px-4 py-3 text-base border-2 border-gray-400 rounded-lg bg-gradient-to-r from-gray-100 to-gray-200 cursor-not-allowed text-gray-700 font-bold shadow-inner">
                </div>
                
                <!-- Last Name Field -->
                <div>
                    <label class="block text-base font-bold text-gray-900 mb-3">👤 Last Name</label>
                    <div class="relative">
                        <input type="text" id="editLastName" required maxlength="50" autocomplete="off" class="w-full px-4 py-3 pr-16 text-base border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-blue-200 focus:border-blue-500 transition-all duration-200 bg-gradient-to-r from-white to-blue-50" oninput="validateNameField('editLastName', 'editLastNameCounter', 50)">
                        <span id="editLastNameCounter" class="absolute right-3 top-3 text-sm font-bold text-blue-600 bg-blue-100 px-2 py-1 rounded-full">0/50</span>
                    </div>
                </div>
                
                <!-- First Name Field -->
                <div>
                    <label class="block text-base font-bold text-gray-900 mb-3">👤 First Name</label>
                    <div class="relative">
                        <input type="text" id="editFirstName" required maxlength="50" autocomplete="off" class="w-full px-4 py-3 pr-16 text-base border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-blue-200 focus:border-blue-500 transition-all duration-200 bg-gradient-to-r from-white to-blue-50" oninput="validateNameField('editFirstName', 'editFirstNameCounter', 50)">
                        <span id="editFirstNameCounter" class="absolute right-3 top-3 text-sm font-bold text-blue-600 bg-blue-100 px-2 py-1 rounded-full">0/50</span>
                    </div>
                </div>
                
                <!-- Middle Name Field -->
                <div>
                    <label class="block text-base font-bold text-gray-900 mb-3">👤 Middle Name <span class="text-sm text-gray-600 font-normal">(Optional)</span></label>
                    <div class="relative">
                        <input type="text" id="editMiddleName" maxlength="50" autocomplete="off" class="w-full px-4 py-3 pr-16 text-base border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-blue-200 focus:border-blue-500 transition-all duration-200 bg-gradient-to-r from-white to-blue-50" oninput="validateNameField('editMiddleName', 'editMiddleNameCounter', 50)">
                        <span id="editMiddleNameCounter" class="absolute right-3 top-3 text-sm font-bold text-blue-600 bg-blue-100 px-2 py-1 rounded-full">0/50</span>
                    </div>
                </div>
                
                <!-- Course Field -->
                <div>
                    <label class="block text-base font-bold text-gray-900 mb-3">🎓 Course</label>
                    <select id="editCourse" required autocomplete="off" class="w-full px-4 py-3 text-base border-2 border-purple-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-purple-200 focus:border-purple-500 transition-all duration-200 bg-gradient-to-r from-white to-purple-50 font-semibold">
                        <option value="" class="text-gray-500">Select Course</option>
                        <option value="BSIT" class="font-semibold">BSIT - Bachelor of Science in Information Technology</option>
                        <option value="BMMA" class="font-semibold">BMMA - Bachelor of Multimedia Arts</option>
                        <option value="CUSTOM" class="font-semibold">CUSTOM - Custom Course</option>
                    </select>
                </div>
                
                <!-- Year Level Field -->
                <div>
                    <label class="block text-base font-bold text-gray-900 mb-3">📚 Year Level</label>
                    <select id="editYearLevel" required autocomplete="off" class="w-full px-4 py-3 text-base border-2 border-purple-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-purple-200 focus:border-purple-500 transition-all duration-200 bg-gradient-to-r from-white to-purple-50 font-semibold">
                        <option value="" class="text-gray-500">Select Year Level</option>
                        <option value="1st Year" class="font-semibold">1st Year</option>
                        <option value="2nd Year" class="font-semibold">2nd Year</option>
                        <option value="3rd Year" class="font-semibold">3rd Year</option>
                        <option value="4th Year" class="font-semibold">4th Year</option>
                    </select>
                </div>
                
                <!-- Address Field -->
                <div class="md:col-span-2">
                    <div class="flex items-center space-x-3 mb-3">
                        <label class="block text-base font-bold text-gray-900">🏠 Address</label>
                        <button type="button" onclick="openEditAddressModal()" class="bg-gradient-to-r from-blue-100 to-blue-200 hover:from-blue-200 hover:to-blue-300 border-2 border-blue-400 rounded-lg px-4 py-2 text-sm font-bold hover:scale-105 transition-all duration-200 shadow-md" title="Address Helper">
                            ❓ Address Helper
                        </button>
                    </div>
                    <div class="relative">
                        <textarea id="editAddress" required rows="4" maxlength="200" autocomplete="off" disabled class="w-full px-4 py-3 pr-20 text-base border-2 border-gray-400 rounded-lg bg-gradient-to-r from-gray-100 to-gray-200 cursor-not-allowed text-gray-700 font-semibold shadow-inner" oninput="updateCounter('editAddress', 'editAddressCounter', 200)" placeholder="Address will be enabled after using the address helper above..."></textarea>
                        <span id="editAddressCounter" class="absolute right-3 top-3 text-sm font-bold text-gray-600 bg-gray-200 px-2 py-1 rounded-full">0/200</span>
                    </div>
                </div>
                
                <!-- Enhanced Action Buttons -->
                <div class="md:col-span-2 flex space-x-4 mt-8 pt-6 border-t-2 border-gray-200">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-4 px-6 rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-300 transform hover:scale-105 shadow-xl">
                        <span class="flex items-center justify-center text-lg">
                            💾 <span class="ml-2">UPDATE STUDENT</span>
                        </span>
                    </button>
                    <button type="button" onclick="closeEditModal()" class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-gray-300 transform hover:scale-105 shadow-xl">
                        <span class="flex items-center justify-center text-lg">
                            ❌ <span class="ml-2">CANCEL</span>
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Subject Modal -->
    <div id="addSubjectModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
        <div class="bg-gradient-to-br from-purple-50 via-white to-blue-50 rounded-2xl shadow-2xl p-8 w-full max-w-2xl mx-4 border-2 border-purple-300 max-h-[90vh] overflow-y-auto backdrop-blur-sm transform transition-all duration-300 scale-95">
            <!-- Enhanced Header with Icon -->
            <div class="text-center mb-8">
                <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-gradient-to-br from-purple-100 to-blue-100 mb-4 shadow-lg border-4 border-purple-300">
                    <svg class="h-8 w-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                </div>
                <h2 class="text-3xl font-black text-gray-900 mb-2 tracking-wide">📚 ADD NEW SUBJECT</h2>
                <p class="text-base text-gray-600 font-semibold">Create a new subject for your class record</p>
            </div>
            
            <form id="addSubjectForm" autocomplete="off" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Subject Code Field -->
                <div>
                    <div class="flex items-center space-x-2 mb-3">
                        <label class="block text-base font-bold text-gray-900">📋 Subject Code</label>
                        <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full font-semibold" title="Example: BSIT-101, ENG-001">Required</span>
                    </div>
                    <div class="relative">
                        <input type="text" id="subjectCode" required maxlength="20" autocomplete="off" placeholder="e.g., BSIT-101" class="w-full px-4 py-3 pr-16 text-base border-2 border-purple-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-purple-200 focus:border-purple-500 transition-all duration-200 bg-gradient-to-r from-white to-purple-50 uppercase" oninput="updateSubjectCounter('subjectCode', 'subjectCodeCounter', 20); this.value = this.value.toUpperCase()">
                        <span id="subjectCodeCounter" class="absolute right-3 top-3 text-sm font-bold text-purple-600 bg-purple-100 px-2 py-1 rounded-full">0/20</span>
                    </div>
                </div>
                
                <!-- Subject Title Field -->
                <div>
                    <div class="flex items-center space-x-2 mb-3">
                        <label class="block text-base font-bold text-gray-900">📖 Subject Title</label>
                        <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-semibold" title="Full descriptive name of the subject">Required</span>
                    </div>
                    <div class="relative">
                        <input type="text" id="subjectTitle" required maxlength="100" autocomplete="off" placeholder="e.g., Introduction to Programming" class="w-full px-4 py-3 pr-16 text-base border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-blue-200 focus:border-blue-500 transition-all duration-200 bg-gradient-to-r from-white to-blue-50" oninput="updateSubjectCounter('subjectTitle', 'subjectTitleCounter', 100)">
                        <span id="subjectTitleCounter" class="absolute right-3 top-3 text-sm font-bold text-blue-600 bg-blue-100 px-2 py-1 rounded-full">0/100</span>
                    </div>
                </div>
                
                <!-- Units Field -->
                <div>
                    <div class="flex items-center space-x-2 mb-3">
                        <label class="block text-base font-bold text-gray-900">🔢 Units</label>
                        <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-semibold" title="Number of credit units">Required</span>
                    </div>
                    <select id="subjectUnits" required autocomplete="off" class="w-full px-4 py-3 text-base border-2 border-green-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-green-200 focus:border-green-500 transition-all duration-200 bg-gradient-to-r from-white to-green-50 font-semibold">
                        <option value="" class="text-gray-500">Select Units</option>
                        <option value="1" class="font-semibold">1 Unit</option>
                        <option value="2" class="font-semibold">2 Units</option>
                        <option value="3" class="font-semibold">3 Units</option>
                        <option value="4" class="font-semibold">4 Units</option>
                        <option value="5" class="font-semibold">5 Units</option>
                        <option value="6" class="font-semibold">6 Units</option>
                    </select>
                </div>
                
                <!-- Semester Field -->
                <div>
                    <div class="flex items-center space-x-2 mb-3">
                        <label class="block text-base font-bold text-gray-900">📅 Semester</label>
                        <span class="text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full font-semibold" title="Academic semester">Required</span>
                    </div>
                    <select id="subjectSemester" required autocomplete="off" class="w-full px-4 py-3 text-base border-2 border-orange-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-orange-200 focus:border-orange-500 transition-all duration-200 bg-gradient-to-r from-white to-orange-50 font-semibold">
                        <option value="" class="text-gray-500">Select Semester</option>
                        <option value="1st Semester" class="font-semibold">1st Semester</option>
                        <option value="2nd Semester" class="font-semibold">2nd Semester</option>
                        <option value="Summer" class="font-semibold">Summer Term</option>
                    </select>
                </div>
                
                <!-- Year Level Field -->
                <div>
                    <div class="flex items-center space-x-2 mb-3">
                        <label class="block text-base font-bold text-gray-900">🎓 Year Level</label>
                        <span class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full font-semibold" title="Target year level">Required</span>
                    </div>
                    <select id="subjectYearLevel" required autocomplete="off" class="w-full px-4 py-3 text-base border-2 border-indigo-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-indigo-200 focus:border-indigo-500 transition-all duration-200 bg-gradient-to-r from-white to-indigo-50 font-semibold">
                        <option value="" class="text-gray-500">Select Year Level</option>
                        <option value="1st Year" class="font-semibold">1st Year</option>
                        <option value="2nd Year" class="font-semibold">2nd Year</option>
                        <option value="3rd Year" class="font-semibold">3rd Year</option>
                        <option value="4th Year" class="font-semibold">4th Year</option>
                    </select>
                </div>
                
                <!-- Prerequisites Field -->
                <div>
                    <div class="flex items-center space-x-2 mb-3">
                        <label class="block text-base font-bold text-gray-900">📝 Prerequisites</label>
                        <span class="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full font-semibold" title="Required subjects before taking this">Optional</span>
                    </div>
                    <div class="relative">
                        <input type="text" id="subjectPrerequisites" maxlength="200" autocomplete="off" placeholder="e.g., MATH-101, ENG-001 (separate with commas)" class="w-full px-4 py-3 pr-16 text-base border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-gray-200 focus:border-gray-500 transition-all duration-200 bg-gradient-to-r from-white to-gray-50" oninput="updateSubjectCounter('subjectPrerequisites', 'subjectPrerequisitesCounter', 200)">
                        <span id="subjectPrerequisitesCounter" class="absolute right-3 top-3 text-sm font-bold text-gray-600 bg-gray-100 px-2 py-1 rounded-full">0/200</span>
                    </div>
                </div>
                
                <!-- Description Field -->
                <div class="md:col-span-2">
                    <div class="flex items-center space-x-2 mb-3">
                        <label class="block text-base font-bold text-gray-900">📄 Description</label>
                        <span class="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full font-semibold" title="Brief description of the subject">Optional</span>
                    </div>
                    <div class="relative">
                        <textarea id="subjectDescription" rows="3" maxlength="500" autocomplete="off" placeholder="Brief description of what this subject covers..." class="w-full px-4 py-3 pr-20 text-base border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-gray-200 focus:border-gray-500 transition-all duration-200 bg-gradient-to-r from-white to-gray-50 resize-none" oninput="updateSubjectCounter('subjectDescription', 'subjectDescriptionCounter', 500)"></textarea>
                        <span id="subjectDescriptionCounter" class="absolute right-3 top-3 text-sm font-bold text-gray-600 bg-gray-100 px-2 py-1 rounded-full">0/500</span>
                    </div>
                </div>
                
                <!-- Enhanced Action Buttons -->
                <div class="md:col-span-2 flex space-x-4 mt-8 pt-6 border-t-2 border-gray-200">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-bold py-4 px-6 rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-purple-300 transform hover:scale-105 shadow-xl">
                        <span class="flex items-center justify-center text-lg">
                            💾 <span class="ml-2">ADD SUBJECT</span>
                        </span>
                    </button>
                    <button type="button" onclick="closeAddSubjectModal()" class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-gray-300 transform hover:scale-105 shadow-xl">
                        <span class="flex items-center justify-center text-lg">
                            ❌ <span class="ml-2">CANCEL</span>
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Status Modal -->
    <div id="statusModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
        <div class="bg-gradient-to-br from-green-50 via-white to-yellow-50 rounded-2xl shadow-2xl p-8 w-[520px] max-w-md mx-4 border-2 border-green-300 backdrop-blur-sm transform transition-all duration-300 scale-95">
            <!-- Enhanced Header with Icon -->
            <div class="text-center mb-8">
                <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-gradient-to-br from-green-100 to-yellow-100 mb-6 shadow-lg border-4 border-green-300 animate-pulse">
                    <svg class="h-10 w-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h2 class="text-3xl font-black text-gray-900 mb-2 tracking-wide">📊 STUDENT STATUS</h2>
                <p class="text-base text-gray-600 font-semibold">Update student enrollment status</p>
            </div>
            
            <div class="space-y-6">
                <!-- Status Selection Section -->
                <div class="bg-gradient-to-r from-white to-gray-50 rounded-xl p-6 border-2 border-gray-200 shadow-lg">
                    <label class="block text-lg font-black text-gray-900 mb-4 text-center">🔄 Select New Status:</label>
                    <div class="space-y-4">
                        <!-- ACTIVE Option -->
                        <label class="flex items-center p-4 rounded-xl border-2 border-green-200 bg-gradient-to-r from-green-50 to-green-100 hover:from-green-100 hover:to-green-200 transition-all duration-200 cursor-pointer hover:scale-105 shadow-md group">
                            <input type="radio" name="studentStatus" value="ACTIVE" class="mr-4 w-5 h-5 text-green-600 focus:ring-green-500 focus:ring-4">
                            <div class="flex items-center space-x-3">
                                <div class="flex items-center justify-center h-12 w-12 rounded-full bg-green-200 group-hover:bg-green-300 transition-all duration-200">
                                    <svg class="h-6 w-6 text-green-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </div>
                                <div>
                                    <span class="text-xl font-bold text-green-700">ACTIVE</span>
                                    <p class="text-sm text-green-600 font-semibold">Student is actively enrolled</p>
                                </div>
                            </div>
                        </label>
                        
                        <!-- PENDING Option -->
                        <label class="flex items-center p-4 rounded-xl border-2 border-yellow-200 bg-gradient-to-r from-yellow-50 to-yellow-100 hover:from-yellow-100 hover:to-yellow-200 transition-all duration-200 cursor-pointer hover:scale-105 shadow-md group">
                            <input type="radio" name="studentStatus" value="PENDING" class="mr-4 w-5 h-5 text-yellow-600 focus:ring-yellow-500 focus:ring-4">
                            <div class="flex items-center space-x-3">
                                <div class="flex items-center justify-center h-12 w-12 rounded-full bg-yellow-200 group-hover:bg-yellow-300 transition-all duration-200">
                                    <svg class="h-6 w-6 text-yellow-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <span class="text-xl font-bold text-yellow-700">PENDING</span>
                                    <p class="text-sm text-yellow-600 font-semibold">Awaiting enrollment confirmation</p>
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Information Box -->
                <div class="bg-gradient-to-r from-blue-100 to-blue-200 border-2 border-blue-300 rounded-xl p-4">
                    <p class="text-sm text-blue-700 font-bold flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        Status changes take effect immediately
                    </p>
                </div>
                
                <!-- Enhanced Action Buttons -->
                <div class="flex space-x-4 pt-6 border-t-2 border-gray-200">
                    <button onclick="updateStatus()" class="flex-1 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-4 px-6 rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-green-300 transform hover:scale-105 shadow-xl">
                        <span class="flex items-center justify-center text-lg">
                            💾 <span class="ml-2">UPDATE STATUS</span>
                        </span>
                    </button>
                    <button onclick="closeStatusModal()" class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-gray-300 transform hover:scale-105 shadow-xl">
                        <span class="flex items-center justify-center text-lg">
                            ❌ <span class="ml-2">CANCEL</span>
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';

        // Auto-generate student ID functionality with gap filling
        async function generateNextStudentId() {
            try {
                const response = await fetch(`${API_BASE}/students`);
                const students = await response.json();
                
                if (students.length === 0) {
                    return '25-0000001';
                }
                
                // Extract all existing student ID numbers
                const existingNumbers = [];
                students.forEach(student => {
                    if (student.studentId && student.studentId.startsWith('25-')) {
                        const numberPart = student.studentId.split('-')[1];
                        const number = parseInt(numberPart, 10);
                        if (!isNaN(number)) {
                            existingNumbers.push(number);
                        }
                    }
                });
                
                // Sort the numbers to find gaps
                existingNumbers.sort((a, b) => a - b);
                
                // Find the first available gap, or use next sequential number
                let nextNumber = 1;
                for (let i = 0; i < existingNumbers.length; i++) {
                    if (existingNumbers[i] === nextNumber) {
                        nextNumber++;
                    } else if (existingNumbers[i] > nextNumber) {
                        // Found a gap! Use the missing number
                        break;
                    }
                }
                
                // Generate the ID with proper padding
                const paddedNumber = nextNumber.toString().padStart(7, '0');
                return `25-${paddedNumber}`;
                
            } catch (error) {
                console.error('Error generating student ID:', error);
                // Fallback to timestamp-based ID if there's an error
                const timestamp = Date.now().toString().slice(-7);
                return `25-${timestamp.padStart(7, '0')}`;
            }
        }

        // Set the auto-generated ID when page loads
        async function setAutoGeneratedId() {
            const studentIdField = document.getElementById('studentId');
            const nextId = await generateNextStudentId();
            studentIdField.value = nextId;
            
            // Ensure middle name field is properly disabled
            resetMiddleNameField();
        }
        
        // Helper function to properly reset middle name field
        function resetMiddleNameField() {
            const middleNameField = document.getElementById('middleName');
            const middleNameCheckbox = document.getElementById('hasMiddleName');
            
            // Ensure checkbox is unchecked
            middleNameCheckbox.checked = false;
            
            // Disable and style the middle name field
            middleNameField.disabled = true;
            middleNameField.value = '';
            middleNameField.classList.add('bg-gray-100', 'cursor-not-allowed');
            middleNameField.classList.remove('focus:ring-2', 'focus:ring-blue-500', 'focus:border-blue-500');
            
            // Update counter
            updateCounter('middleName', 'middleNameCounter', 50);
        }

        // Load students on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadStudents();
            setAutoGeneratedId(); // Set auto-generated student ID
        });

        document.getElementById('studentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const student = {
                studentId: document.getElementById('studentId').value,
                lastName: document.getElementById('lastName').value,
                firstName: document.getElementById('firstName').value,
                middleName: document.getElementById('middleName').value,
                course: document.getElementById('course').value,
                yearLevel: document.getElementById('yearLevel').value,
                address: document.getElementById('address').value
            };

            try {
                const response = await fetch(`${API_BASE}/students`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(student)
                });

                if (response.ok) {
                    // Reset form but keep the student ID field disabled
                    this.reset();
                    
                    // Properly reset middle name field
                    resetMiddleNameField();
                    
                    // Generate new ID for next student
                    await setAutoGeneratedId();
                    loadStudents();
                    
                    // Show custom success popup instead of browser alert
                    const fullName = `${student.firstName} ${student.lastName}`;
                    showSuccessModal(fullName, student.studentId);
                } else {
                    const error = await response.json();
                    alert(error.error);
                }
            } catch (error) {
                alert('Error adding student: ' + error.message);
            }
        });

        async function loadStudents() {
            try {
                const response = await fetch(`${API_BASE}/students`);
                const students = await response.json();
                displayStudents(students);
            } catch (error) {
                console.error('Error loading students:', error);
            }
        }

        function displayStudents(students) {
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';

            students.forEach((student, index) => {
                const status = student.status || 'PENDING';
                const statusEmoji = status === 'ACTIVE' ? '✅' : '⏳';
                const statusColor = status === 'ACTIVE' ? 'bg-green-500 hover:bg-green-600' : 'bg-yellow-500 hover:bg-yellow-600';
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td class="px-2 sm:px-3 py-3 border border-gray-300 text-sm font-semibold text-gray-900 text-center">${index + 1}</td>
                    <td class="px-2 sm:px-3 py-3 border border-gray-300 text-sm font-semibold text-gray-900">${student.studentId}</td>
                    <td class="px-2 sm:px-3 py-3 border border-gray-300 text-sm font-semibold text-gray-900">${student.lastName}</td>
                    <td class="px-2 sm:px-3 py-3 border border-gray-300 text-sm font-semibold text-gray-900">${student.firstName}</td>
                    <td class="px-2 sm:px-3 py-3 border border-gray-300 text-sm font-semibold text-gray-900">${student.course || ''}</td>
                    <td class="px-2 sm:px-3 py-3 border border-gray-300 text-sm font-semibold text-gray-900">${student.yearLevel || ''}</td>
                    <td class="px-2 sm:px-3 py-3 border border-gray-300">
                        <button onclick="editStudent('${student._id}')" class="bg-blue-500 hover:bg-blue-600 text-white p-2 rounded mr-1 text-sm font-bold" title="Edit">
                            ✏️
                        </button>
                        <button onclick="openStatusModal('${student._id}')" class="${statusColor} text-white p-2 rounded mr-1 text-sm font-bold" title="Status: ${status}">
                            ${statusEmoji}
                        </button>
                        <button onclick="deleteStudent('${student._id}')" class="bg-red-500 hover:bg-red-600 text-white p-2 rounded text-sm font-bold" title="Delete">
                            🗑️
                        </button>
                    </td>
                `;
            });
        }

        // Success modal functions
        function showSuccessModal(studentName, studentId) {
            const modal = document.getElementById('successModal');
            const messageDiv = document.getElementById('successMessage');
            
            messageDiv.innerHTML = `
                <p class="mb-2"><strong>Name:</strong> ${studentName}</p>
                <p><strong>Student ID:</strong> ${studentId}</p>
            `;
            
            modal.classList.remove('hidden');
            modal.querySelector('.bg-gradient-to-br').classList.remove('scale-95');
            modal.querySelector('.bg-gradient-to-br').classList.add('scale-100');
            document.body.style.overflow = 'hidden';
            
            // Auto close after 5 seconds
            setTimeout(() => {
                closeSuccessModal();
            }, 5000);
        }
        
        function closeSuccessModal() {
            const modal = document.getElementById('successModal');
            const modalContent = modal.querySelector('.bg-gradient-to-br');
            
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }, 300);
        }
        
        let studentToDelete = null;
        let studentToDeleteInfo = null;
        
        function deleteStudent(id) {
            // Find the student data to show in confirmation
            const student = allStudents.find(s => s._id === id);
            if (student) {
                studentToDelete = id;
                studentToDeleteInfo = student;
                
                // Populate the modal with enhanced student information
                const deleteInfoDiv = document.getElementById('deleteStudentInfo');
                const fullName = `${student.firstName} ${student.lastName}${student.middleName ? ' ' + student.middleName : ''}`;
                const statusColor = student.status === 'ACTIVE' ? 'text-green-600' : 'text-yellow-600';
                const statusBg = student.status === 'ACTIVE' ? 'bg-green-100' : 'bg-yellow-100';
                
                deleteInfoDiv.innerHTML = `
                    <div class="bg-gradient-to-r from-white to-gray-50 rounded-xl p-6 border-2 border-gray-200 shadow-lg mb-4">
                        <div class="text-center mb-4">
                            <h4 class="text-lg font-bold text-gray-800 mb-2">Student to be deleted:</h4>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-bold text-gray-700">📋 Student ID:</span>
                                <span class="text-sm font-black text-blue-600 bg-blue-100 px-3 py-1 rounded-full">${student.studentId}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-bold text-gray-700">👤 Full Name:</span>
                                <span class="text-sm font-semibold text-gray-800">${fullName}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-bold text-gray-700">🎓 Course:</span>
                                <span class="text-sm font-semibold text-purple-600 bg-purple-100 px-3 py-1 rounded-full">${student.course || 'N/A'}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-bold text-gray-700">📚 Year Level:</span>
                                <span class="text-sm font-semibold text-indigo-600 bg-indigo-100 px-3 py-1 rounded-full">${student.yearLevel || 'N/A'}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-bold text-gray-700">📊 Status:</span>
                                <span class="text-sm font-bold ${statusColor} ${statusBg} px-3 py-1 rounded-full">${student.status || 'PENDING'}</span>
                            </div>
                            ${student.address ? `
                            <div class="mt-3 pt-3 border-t border-gray-200">
                                <span class="text-sm font-bold text-gray-700">🏠 Address:</span>
                                <p class="text-sm text-gray-600 mt-1 italic">${student.address}</p>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                    <p class="text-lg text-gray-800 font-bold text-center">Are you absolutely sure you want to delete this student?</p>
                `;
                
                // Show modal with enhanced animation
                const modal = document.getElementById('deleteModal');
                modal.classList.remove('hidden');
                const modalContent = modal.querySelector('.bg-gradient-to-br');
                modalContent.classList.remove('scale-95');
                modalContent.classList.add('scale-100');
                document.body.style.overflow = 'hidden';
                
                // Focus trap for accessibility
                setTimeout(() => {
                    modal.querySelector('button').focus();
                }, 100);
            }
        }
        
        function closeDeleteModal() {
            const modal = document.getElementById('deleteModal');
            const modalContent = modal.querySelector('.bg-gradient-to-br');
            
            // Animate out
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                studentToDelete = null;
                studentToDeleteInfo = null;
            }, 300);
        }
        
        async function confirmDelete() {
            if (studentToDelete) {
                try {
                    await fetch(`${API_BASE}/students/${studentToDelete}`, { method: 'DELETE' });
                    loadStudents();
                    closeDeleteModal();
                } catch (error) {
                    alert('Error deleting student: ' + error.message);
                }
            }
        }

        // Note: showSection function is now defined above with subject loading capability
        
        // Load curriculum data
        async function loadCurriculum() {
            try {
                // Load First Year First Semester
                const response1_1 = await fetch(`${API_BASE}/curriculum/1/1`);
                const subjects1_1 = await response1_1.json();
                displayCurriculum(subjects1_1, 'curriculum-1-1-body');
                
                // Load First Year Second Semester
                const response1_2 = await fetch(`${API_BASE}/curriculum/1/2`);
                const subjects1_2 = await response1_2.json();
                displayCurriculum(subjects1_2, 'curriculum-1-2-body');
                
                // Load Second Year First Semester
                const response2_1 = await fetch(`${API_BASE}/curriculum/2/1`);
                const subjects2_1 = await response2_1.json();
                displayCurriculum(subjects2_1, 'curriculum-2-1-body');
                
                // Load Second Year Second Semester
                const response2_2 = await fetch(`${API_BASE}/curriculum/2/2`);
                const subjects2_2 = await response2_2.json();
                displayCurriculum(subjects2_2, 'curriculum-2-2-body');
                

            } catch (error) {
                console.error('Error loading curriculum:', error);
            }
        }
        
        function displayCurriculum(subjects, tbodyId) {
            const tbody = document.getElementById(tbodyId);
            tbody.innerHTML = '';
            
            let totalLec = 0, totalLab = 0, totalUnits = 0;
            
            subjects.forEach(subject => {
                totalLec += subject.lecUnits;
                totalLab += subject.labUnits;
                totalUnits += subject.totalUnits;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td class="px-3 py-2 border border-gray-300 text-sm">${subject.code}</td>
                    <td class="px-3 py-2 border border-gray-300 text-sm">${subject.title}</td>
                    <td class="px-3 py-2 border border-gray-300 text-sm text-center">${subject.lecUnits}</td>
                    <td class="px-3 py-2 border border-gray-300 text-sm text-center">${subject.labUnits}</td>
                    <td class="px-3 py-2 border border-gray-300 text-sm text-center">${subject.totalUnits}</td>
                    <td class="px-3 py-2 border border-gray-300 text-sm">${subject.prerequisite}</td>
                `;
            });
            
            // Add total row
            const totalRow = tbody.insertRow();
            totalRow.innerHTML = `
                <td class="px-3 py-2 border border-gray-300 text-sm font-bold" colspan="2">Total</td>
                <td class="px-3 py-2 border border-gray-300 text-sm font-bold text-center">${totalLec}</td>
                <td class="px-3 py-2 border border-gray-300 text-sm font-bold text-center">${totalLab}</td>
                <td class="px-3 py-2 border border-gray-300 text-sm font-bold text-center">${totalUnits}</td>
                <td class="px-3 py-2 border border-gray-300 text-sm"></td>
            `;
            totalRow.classList.add('bg-gray-100');
        }

        function resetGradingPeriod() {
            // Hide grading grid
            document.getElementById('gradingGrid').classList.add('hidden');
            
            // Reset all icon styles
            const allIcons = ['prelim-icon', 'midterm-icon', 'finals-icon'];
            allIcons.forEach(iconId => {
                const icon = document.getElementById(iconId);
                icon.classList.remove('blur-sm', 'opacity-50', 'scale-110');
            });
        }

        function editStudent(id) {
            fetch(`${API_BASE}/students`)
                .then(response => response.json())
                .then(students => {
                    const student = students.find(s => s._id === id);
                    if (student) {
                        // Populate modal form with student data
                        document.getElementById('editStudentId').value = student.studentId;
                        document.getElementById('editLastName').value = student.lastName;
                        document.getElementById('editFirstName').value = student.firstName;
                        document.getElementById('editMiddleName').value = student.middleName || '';
                        document.getElementById('editCourse').value = student.course || '';
                        document.getElementById('editYearLevel').value = student.yearLevel || '';
                        
                        // Enable address field temporarily to set value
                        const editAddressField = document.getElementById('editAddress');
                        editAddressField.disabled = false;
                        editAddressField.value = student.address;
                        editAddressField.disabled = true;
                        
                        // Update character counters with enhanced styling
                        validateNameField('editLastName', 'editLastNameCounter', 50);
                        validateNameField('editFirstName', 'editFirstNameCounter', 50);
                        validateNameField('editMiddleName', 'editMiddleNameCounter', 50);
                        updateCounter('editAddress', 'editAddressCounter', 200);
                        
                        // Store student ID for update
                        document.getElementById('editForm').setAttribute('data-student-id', id);
                        
                        // Show modal with enhanced animation
                        const modal = document.getElementById('editModal');
                        modal.classList.remove('hidden');
                        
                        // Enhanced animation sequence
                        const modalContent = modal.querySelector('.bg-gradient-to-br');
                        modalContent.classList.remove('scale-95');
                        modalContent.classList.add('scale-100');
                        
                        // Prevent body scroll
                        document.body.style.overflow = 'hidden';
                        
                        // Focus on first editable field for better UX
                        setTimeout(() => {
                            document.getElementById('editLastName').focus();
                        }, 300);
                    }
                })
                .catch(error => {
                    // Enhanced error display
                    showCustomAlert('Error loading student data: ' + error.message, 'error');
                });
        }

        function closeEditModal() {
            const modal = document.getElementById('editModal');
            const modalContent = modal.querySelector('.bg-gradient-to-br');
            
            // Enhanced closing animation
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            
            // Fade out and hide modal
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                
                // Reset form for clean state
                document.getElementById('editForm').reset();
            }, 300);
        }

        // Edit form submission
        document.getElementById('editForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const studentId = this.getAttribute('data-student-id');
            const updatedStudent = {
                lastName: document.getElementById('editLastName').value,
                firstName: document.getElementById('editFirstName').value,
                middleName: document.getElementById('editMiddleName').value,
                course: document.getElementById('editCourse').value,
                yearLevel: document.getElementById('editYearLevel').value,
                address: document.getElementById('editAddress').value
            };

            try {
                const response = await fetch(`${API_BASE}/students/${studentId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedStudent)
                });

                if (response.ok) {
                    closeEditModal();
                    loadStudents();
                } else {
                    const error = await response.json();
                    alert(error.error);
                }
            } catch (error) {
                alert('Error updating student: ' + error.message);
            }
        });

        // Filter functionality
        let allStudents = [];
        
        function applyFilters() {
            const statusFilter = document.getElementById('statusFilter').value;
            const idSearch = document.getElementById('searchId').value.toLowerCase();
            const nameSearch = document.getElementById('searchName').value.toLowerCase();
            const courseFilter = document.getElementById('courseSort').value;
            const idSort = document.getElementById('idSort').value;
            
            let filteredStudents = allStudents.filter(student => {
                const matchesStatus = !statusFilter || (student.status || 'PENDING') === statusFilter;
                const matchesId = !idSearch || student.studentId.toLowerCase().includes(idSearch);
                const matchesName = !nameSearch || 
                    student.lastName.toLowerCase().includes(nameSearch) ||
                    student.firstName.toLowerCase().includes(nameSearch);
                const matchesCourse = !courseFilter || student.course === courseFilter;
                
                return matchesStatus && matchesId && matchesName && matchesCourse;
            });
            
            // Sort by Student ID if selected
            if (idSort === 'asc') {
                filteredStudents.sort((a, b) => a.studentId.localeCompare(b.studentId, undefined, { numeric: true }));
            } else if (idSort === 'desc') {
                filteredStudents.sort((a, b) => b.studentId.localeCompare(a.studentId, undefined, { numeric: true }));
            }
            
            displayStudents(filteredStudents);
        }
        
        document.getElementById('statusFilter').addEventListener('change', applyFilters);
        document.getElementById('searchId').addEventListener('input', applyFilters);
        document.getElementById('searchName').addEventListener('input', applyFilters);
        document.getElementById('courseSort').addEventListener('change', applyFilters);
        document.getElementById('idSort').addEventListener('change', applyFilters);
        
        function populateCourseFilter() {
            const courseSelect = document.getElementById('courseSort');
            const courses = [...new Set(allStudents.map(s => s.course).filter(c => c))];
            
            courseSelect.innerHTML = '<option value="">All Courses</option>';
            courses.forEach(course => {
                courseSelect.innerHTML += `<option value="${course}">${course}</option>`;
            });
        }

        // Update loadStudents to store all students
        async function loadStudents() {
            try {
                const response = await fetch(`${API_BASE}/students`);
                allStudents = await response.json();
                populateCourseFilter();
                displayStudents(allStudents);
            } catch (error) {
                console.error('Error loading students:', error);
            }
        }

        // Dropdown functionality
        function toggleDropdown() {
            const dropdown = document.getElementById('dropdown');
            dropdown.classList.toggle('hidden');
        }

        function closeDropdown() {
            document.getElementById('dropdown').classList.add('hidden');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('dropdown');
            const menuButton = event.target.closest('button');
            if (!menuButton || menuButton.onclick.toString().indexOf('toggleDropdown') === -1) {
                dropdown.classList.add('hidden');
            }
        });

        // Grading grid functions
        async function showGradingGrid(period) {
            const grid = document.getElementById('gradingGrid');
            const tbody = document.getElementById('gradingTableBody');
            
            // Apply blur animation to other icons
            const allIcons = ['prelim-icon', 'midterm-icon', 'finals-icon'];
            allIcons.forEach(iconId => {
                const icon = document.getElementById(iconId);
                if (iconId === period + '-icon') {
                    icon.classList.remove('blur-sm', 'opacity-50');
                    icon.classList.add('scale-110');
                } else {
                    icon.classList.add('blur-sm', 'opacity-50');
                    icon.classList.remove('scale-110');
                }
            });
            
            // Load and display student data for grading
            await loadGradingData(period);
            
            grid.classList.remove('hidden');
        }

        async function loadGradingData(period = '') {
            try {
                const response = await fetch(`${API_BASE}/students`);
                let students = await response.json();
                
                // Filter only active students for grading
                students = students.filter(student => (student.status || 'PENDING') === 'ACTIVE');
                
                displayGradingData(students, period);
            } catch (error) {
                console.error('Error loading grading data:', error);
                const tbody = document.getElementById('gradingTableBody');
                tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-12 text-center text-red-500 font-medium tracking-wide">Error loading student data</td></tr>';
            }
        }

        function displayGradingData(students, period = '') {
            const tbody = document.getElementById('gradingTableBody');
            tbody.innerHTML = '';

            if (students.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-12 text-center text-slate-500 font-medium tracking-wide">No active students found</td></tr>';
                return;
            }

            students.forEach((student, index) => {
                // Format full name with middle name if available
                const middleName = student.middleName ? ` ${student.middleName}` : '';
                const fullName = `${student.lastName}, ${student.firstName}${middleName}`;
                
                const row = tbody.insertRow();
                row.className = 'hover:bg-slate-50 transition-colors duration-200 border-b border-slate-200';
                row.innerHTML = `
                    <td class="px-6 py-4 text-sm font-bold text-slate-700 text-center">${index + 1}</td>
                    <td class="px-6 py-4 text-sm font-semibold text-blue-600">${student.studentId}</td>
                    <td class="px-6 py-4 text-sm font-semibold text-slate-800">${fullName}</td>
                    <td class="px-6 py-4 text-sm font-medium text-amber-600 text-center bg-amber-50 rounded-md border border-amber-200">
                        <span class="px-2 py-1 bg-amber-100 text-amber-700 rounded-full text-xs font-bold tracking-wide">TBD</span>
                    </td>
                    <td class="px-6 py-4 text-sm font-medium text-slate-600 text-center italic">
                        <span class="text-slate-400">— No remarks yet —</span>
                    </td>
                `;
            });
        }

        function addGrade(studentId, lastName) {
            alert(`Add grade for Student ID: ${studentId}, Last Name: ${lastName}`);
        }



        // Toggle filter side panel
        function toggleFilters() {
            const sidePanel = document.getElementById('filterSidePanel');
            const overlay = document.getElementById('filterOverlay');
            
            if (!sidePanel || !overlay) return;
            
            // Enhanced opening animation
            sidePanel.classList.remove('translate-x-full');
            sidePanel.classList.add('translate-x-0');
            overlay.classList.remove('hidden');
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
            
            // Add slide-in animation with better state management
            requestAnimationFrame(() => {
                sidePanel.style.transform = 'translateX(0)';
            });
        }
        
        function closeFilters() {
            const sidePanel = document.getElementById('filterSidePanel');
            const overlay = document.getElementById('filterOverlay');
            
            if (!sidePanel || !overlay) return;
            
            // Enhanced closing animation
            sidePanel.classList.remove('translate-x-0');
            sidePanel.classList.add('translate-x-full');
            
            // Reset transform style
            sidePanel.style.transform = '';
            
            // Delay overlay hiding for smooth animation
            setTimeout(() => {
                if (overlay && sidePanel) {
                    overlay.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                }
            }, 300);
        }
        
        // Clear all filters function
        function clearAllFilters() {
            // Reset all filter fields
            document.getElementById('statusFilter').value = '';
            document.getElementById('searchId').value = '';
            document.getElementById('searchName').value = '';
            document.getElementById('courseSort').value = '';
            document.getElementById('idSort').value = '';
            
            // Apply filters to show all students
            applyFilters();
            
            // Visual feedback
            const clearButton = event.target.closest('button');
            const originalText = clearButton.innerHTML;
            
            clearButton.innerHTML = '<span class="flex items-center justify-center text-lg">✅ <span class="ml-2">FILTERS CLEARED!</span></span>';
            clearButton.classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-600');
            
            setTimeout(() => {
                clearButton.innerHTML = originalText;
                clearButton.classList.remove('bg-gradient-to-r', 'from-green-500', 'to-green-600');
            }, 1500);
        }

        // ID column sorting
        let currentIdSort = 'default';
        
        function toggleIdSort() {
            const idSortSelect = document.getElementById('idSort');
            
            if (currentIdSort === 'default' || currentIdSort === 'desc') {
                currentIdSort = 'asc';
                idSortSelect.value = 'asc';
            } else {
                currentIdSort = 'desc';
                idSortSelect.value = 'desc';
            }
            
            applyFilters();
        }

        // Status modal functions
        function openStatusModal(studentId) {
            fetch(`${API_BASE}/students`)
                .then(response => response.json())
                .then(students => {
                    const student = students.find(s => s._id === studentId);
                    if (student) {
                        // Set current status or default to PENDING
                        const currentStatus = student.status || 'PENDING';
                        const statusRadio = document.querySelector(`input[name="studentStatus"][value="${currentStatus}"]`);
                        if (statusRadio) {
                            statusRadio.checked = true;
                        }
                        
                        // Store student ID for update
                        document.getElementById('statusModal').setAttribute('data-student-id', studentId);
                        
                        // Show modal with enhanced animation
                        const modal = document.getElementById('statusModal');
                        modal.classList.remove('hidden');
                        
                        // Enhanced animation sequence
                        const modalContent = modal.querySelector('.bg-gradient-to-br');
                        modalContent.classList.remove('scale-95');
                        modalContent.classList.add('scale-100');
                        
                        // Prevent body scroll
                        document.body.style.overflow = 'hidden';
                        
                        // Focus on checked radio button for better UX
                        setTimeout(() => {
                            const checkedRadio = document.querySelector('input[name="studentStatus"]:checked');
                            if (checkedRadio) {
                                checkedRadio.focus();
                            }
                        }, 300);
                    }
                })
                .catch(error => {
                    // Enhanced error display
                    console.error('Error loading student data:', error);
                    alert('Error loading student data: ' + error.message);
                });
        }

        function closeStatusModal() {
            const modal = document.getElementById('statusModal');
            const modalContent = modal.querySelector('.bg-gradient-to-br');
            
            // Enhanced closing animation
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            
            // Fade out and hide modal
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                
                // Clear any selected status for clean state
                const radioButtons = document.querySelectorAll('input[name="studentStatus"]');
                radioButtons.forEach(radio => radio.checked = false);
            }, 300);
        }

        async function updateStatus() {
            const modal = document.getElementById('statusModal');
            const studentId = modal.getAttribute('data-student-id');
            const selectedStatus = document.querySelector('input[name="studentStatus"]:checked')?.value;
            
            if (!selectedStatus) {
                // Enhanced validation message
                const radioButtons = document.querySelectorAll('input[name="studentStatus"]');
                radioButtons.forEach(radio => {
                    radio.parentElement.classList.add('animate-pulse');
                    setTimeout(() => {
                        radio.parentElement.classList.remove('animate-pulse');
                    }, 1000);
                });
                
                alert('Please select a status before updating.');
                return;
            }

            try {
                // Add loading state to button
                const updateButton = modal.querySelector('button[onclick="updateStatus()"]');
                const originalText = updateButton.innerHTML;
                updateButton.innerHTML = '<span class="flex items-center justify-center text-lg">⏳ <span class="ml-2">UPDATING...</span></span>';
                updateButton.disabled = true;
                
                const response = await fetch(`${API_BASE}/students/${studentId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status: selectedStatus })
                });

                if (response.ok) {
                    // Success feedback
                    updateButton.innerHTML = '<span class="flex items-center justify-center text-lg">✅ <span class="ml-2">UPDATED!</span></span>';
                    
                    setTimeout(() => {
                        closeStatusModal();
                        loadStudents();
                        
                        // Refresh grading grid if it's currently visible
                        const gradingGrid = document.getElementById('gradingGrid');
                        if (!gradingGrid.classList.contains('hidden')) {
                            loadGradingData('');
                        }
                        
                        // Reset button
                        updateButton.innerHTML = originalText;
                        updateButton.disabled = false;
                    }, 1000);
                } else {
                    const error = await response.json();
                    updateButton.innerHTML = originalText;
                    updateButton.disabled = false;
                    alert('Error: ' + error.error);
                }
            } catch (error) {
                // Reset button on error
                const updateButton = modal.querySelector('button[onclick="updateStatus()"]');
                updateButton.innerHTML = '<span class="flex items-center justify-center text-lg">💾 <span class="ml-2">UPDATE STATUS</span></span>';
                updateButton.disabled = false;
                alert('Error updating status: ' + error.message);
            }
        }

        // Enhanced name field validation function with number restriction
        function validateNameField(inputId, counterId, maxLength) {
            const input = document.getElementById(inputId);
            const counter = document.getElementById(counterId);
            const value = input.value;
            
            // Remove any numbers and non-letter characters (except spaces, hyphens, and apostrophes)
            const cleanedValue = value.replace(/[^a-zA-Z\s\-\']/g, '');
            
            // Update input if value was changed
            if (value !== cleanedValue) {
                input.value = cleanedValue;
                
                // Visual feedback for invalid input
                input.classList.add('border-red-500', 'bg-red-50');
                input.classList.remove('border-gray-400', 'border-blue-500');
                
                // Show warning message
                showNameValidationWarning(input, 'Numbers and special characters are not allowed in names!');
                
                // Reset border color after 2 seconds
                setTimeout(() => {
                    input.classList.remove('border-red-500', 'bg-red-50');
                    input.classList.add('border-gray-400');
                    clearNameValidationWarning(input);
                }, 2000);
            }
            
            // Update character counter
            const currentLength = cleanedValue.length;
            counter.textContent = `${currentLength}/${maxLength}`;
            
            // Update counter color based on length
            if (currentLength >= maxLength * 0.9) {
                counter.classList.add('text-red-500', 'font-bold');
                counter.classList.remove('text-gray-600');
            } else {
                counter.classList.add('text-gray-600');
                counter.classList.remove('text-red-500', 'font-bold');
            }
        }
        
        // Show validation warning message
        function showNameValidationWarning(input, message) {
            // Remove existing warning
            clearNameValidationWarning(input);
            
            // Create warning element
            const warning = document.createElement('div');
            warning.className = 'validation-warning absolute -bottom-6 left-0 text-red-600 text-xs font-semibold bg-red-100 px-2 py-1 rounded-md border border-red-300 z-10';
            warning.textContent = message;
            
            // Add to input container
            input.parentElement.style.position = 'relative';
            input.parentElement.appendChild(warning);
        }
        
        // Clear validation warning message
        function clearNameValidationWarning(input) {
            const warning = input.parentElement.querySelector('.validation-warning');
            if (warning) {
                warning.remove();
            }
        }
        
        // Character counter function (keeping the original for other fields)
        function updateCounter(inputId, counterId, maxLength) {
            const input = document.getElementById(inputId);
            const counter = document.getElementById(counterId);
            const currentLength = input.value.length;
            
            counter.textContent = `${currentLength}/${maxLength}`;
            
            // Change color when approaching limit
            if (currentLength >= maxLength * 0.9) {
                counter.classList.add('text-red-500');
                counter.classList.remove('text-gray-500');
            } else {
                counter.classList.add('text-gray-500');
                counter.classList.remove('text-red-500');
            }
        }

        // Address modal functions
        function openAddressModal() {
            document.getElementById('addressModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeAddressModal() {
            document.getElementById('addressModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function generateAddress() {
            const country = document.getElementById('country').value.trim();
            const region = document.getElementById('region').value.trim();
            const province = document.getElementById('province').value.trim();
            const municipality = document.getElementById('municipality').value.trim();
            const barangay = document.getElementById('barangay').value.trim();
            const streetAddress = document.getElementById('streetAddress').value.trim();
            
            const addressParts = [streetAddress, barangay, municipality, province, region, country].filter(part => part !== '');
            const fullAddress = addressParts.join(', ');
            
            // Check if we're in edit mode
            const isEditMode = document.getElementById('addressModal').getAttribute('data-edit-mode') === 'true';
            
            if (isEditMode) {
                // Enable edit address field temporarily to set value
                const editAddressField = document.getElementById('editAddress');
                editAddressField.disabled = false;
                editAddressField.value = fullAddress;
                updateCounter('editAddress', 'editAddressCounter', 200);
                editAddressField.disabled = true;
                
                // Clear edit mode flag
                document.getElementById('addressModal').removeAttribute('data-edit-mode');
            } else {
                // Enable main address field temporarily to set value
                const addressField = document.getElementById('address');
                addressField.disabled = false;
                addressField.value = fullAddress;
                updateCounter('address', 'addressCounter', 200);
                addressField.disabled = true;
            }
            
            // Clear all fields except country
            document.getElementById('region').value = '';
            document.getElementById('province').value = '';
            document.getElementById('municipality').value = '';
            document.getElementById('barangay').value = '';
            document.getElementById('streetAddress').value = '';
            
            closeAddressModal();
        }

        function toggleRegionDropdown() {
            document.getElementById('regionDropdown').classList.toggle('hidden');
        }

        function selectRegion(region) {
            document.getElementById('region').value = region;
            document.getElementById('regionDropdown').classList.add('hidden');
            
            // Clear dependent fields
            document.getElementById('province').value = '';
            document.getElementById('municipality').value = '';
            document.getElementById('barangay').value = '';
            
            // Load provinces for selected region
            loadProvinces(region);
        }

        // Philippine address data cache
        let addressCache = {
            provinces: {},
            municipalities: {},
            barangays: {}
        };

        async function loadProvinces(region) {
            const provinceList = document.getElementById('provinceList');
            provinceList.innerHTML = '<div class="text-center py-4 text-gray-500">Loading...</div>';
            
            try {
                if (!addressCache.provinces[region]) {
                    const response = await fetch(`https://psgc.gitlab.io/api/provinces/`);
                    const allProvinces = await response.json();
                    
                    // Complete region to province mapping
                    const regionMapping = {
                        'NCR': ['Metro Manila'],
                        'CAR': ['Abra', 'Apayao', 'Benguet', 'Ifugao', 'Kalinga', 'Mountain Province'],
                        'Region I': ['Ilocos Norte', 'Ilocos Sur', 'La Union', 'Pangasinan'],
                        'Region II': ['Batanes', 'Cagayan', 'Isabela', 'Nueva Vizcaya', 'Quirino'],
                        'Region III': ['Aurora', 'Bataan', 'Bulacan', 'Nueva Ecija', 'Pampanga', 'Tarlac', 'Zambales'],
                        'Region IV-A': ['Batangas', 'Cavite', 'Laguna', 'Quezon', 'Rizal'],
                        'Region IV-B': ['Marinduque', 'Occidental Mindoro', 'Oriental Mindoro', 'Palawan', 'Romblon'],
                        'Region V': ['Albay', 'Camarines Norte', 'Camarines Sur', 'Catanduanes', 'Masbate', 'Sorsogon'],
                        'Region VI': ['Aklan', 'Antique', 'Capiz', 'Guimaras', 'Iloilo', 'Negros Occidental'],
                        'Region VII': ['Bohol', 'Cebu', 'Negros Oriental', 'Siquijor'],
                        'Region VIII': ['Biliran', 'Eastern Samar', 'Leyte', 'Northern Samar', 'Samar', 'Southern Leyte'],
                        'Region IX': ['Zamboanga del Norte', 'Zamboanga del Sur', 'Zamboanga Sibugay'],
                        'Region X': ['Bukidnon', 'Camiguin', 'Lanao del Norte', 'Misamis Occidental', 'Misamis Oriental'],
                        'Region XI': ['Davao de Oro', 'Davao del Norte', 'Davao del Sur', 'Davao Occidental', 'Davao Oriental'],
                        'Region XII': ['Cotabato', 'Sarangani', 'South Cotabato', 'Sultan Kudarat'],
                        'Region XIII': ['Agusan del Norte', 'Agusan del Sur', 'Dinagat Islands', 'Surigao del Norte', 'Surigao del Sur'],
                        'BARMM': ['Basilan', 'Lanao del Sur', 'Maguindanao', 'Sulu', 'Tawi-Tawi']
                    };
                    
                    addressCache.provinces[region] = regionMapping[region] || [];
                }
                
                const provinces = addressCache.provinces[region];
                
                if (provinces.length === 0) {
                    provinceList.innerHTML = '<div class="text-center py-4 text-gray-500">No provinces available</div>';
                    return;
                }
                
                provinceList.innerHTML = provinces.map(province => 
                    `<button type="button" onclick="selectProvince('${province}')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">${province}</button>`
                ).join('');
            } catch (error) {
                provinceList.innerHTML = '<div class="text-center py-4 text-red-500">Error loading provinces</div>';
            }
        }

        async function loadMunicipalities(province) {
            const municipalityList = document.getElementById('municipalityList');
            municipalityList.innerHTML = '<div class="text-center py-4 text-gray-500">Loading...</div>';
            
            try {
                if (!addressCache.municipalities[province]) {
                    // Get province code first
                    const provinceResponse = await fetch(`https://psgc.gitlab.io/api/provinces/`);
                    const allProvinces = await provinceResponse.json();
                    const provinceData = allProvinces.find(p => p.name === province);
                    
                    if (!provinceData) {
                        municipalityList.innerHTML = '<div class="text-center py-4 text-gray-500">Province not found</div>';
                        return;
                    }
                    
                    // Get municipalities for this province
                    const municipalityResponse = await fetch(`https://psgc.gitlab.io/api/cities-municipalities/`);
                    const allMunicipalities = await municipalityResponse.json();
                    
                    // Filter by province code
                    addressCache.municipalities[province] = allMunicipalities
                        .filter(m => m.provinceCode === provinceData.code)
                        .map(m => ({ name: m.name, code: m.code }));
                }
                
                const municipalities = addressCache.municipalities[province];
                
                if (municipalities.length === 0) {
                    municipalityList.innerHTML = '<div class="text-center py-4 text-gray-500">No municipalities available</div>';
                    return;
                }
                
                municipalityList.innerHTML = municipalities.map(municipality => 
                    `<button type="button" onclick="selectMunicipality('${municipality.name}', '${municipality.code}')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">${municipality.name}</button>`
                ).join('');
            } catch (error) {
                municipalityList.innerHTML = '<div class="text-center py-4 text-red-500">Error loading municipalities</div>';
            }
        }

        async function loadBarangays(municipality, municipalityCode) {
            const barangayList = document.getElementById('barangayList');
            barangayList.innerHTML = '<div class="text-center py-4 text-gray-500">Loading...</div>';
            
            try {
                if (!addressCache.barangays[municipality]) {
                    const response = await fetch(`https://psgc.gitlab.io/api/barangays/`);
                    const allBarangays = await response.json();
                    
                    // Try different possible field names for municipality code
                    addressCache.barangays[municipality] = allBarangays
                        .filter(b => b.cityMunCode === municipalityCode || b.municipalityCode === municipalityCode || b.code?.startsWith(municipalityCode?.substring(0, 6)))
                        .slice(0, 50)
                        .map(b => b.name);
                }
                
                const barangays = addressCache.barangays[municipality];
                
                if (barangays.length === 0) {
                    barangayList.innerHTML = '<div class="text-center py-4 text-gray-500">No barangays available</div>';
                    return;
                }
                
                barangayList.innerHTML = barangays.map(barangay => 
                    `<button type="button" onclick="selectBarangay('${barangay}')" class="block w-full px-3 py-2 text-left text-sm hover:bg-blue-50">${barangay}</button>`
                ).join('');
            } catch (error) {
                barangayList.innerHTML = '<div class="text-center py-4 text-red-500">Error loading barangays</div>';
            }
        }

        function toggleProvinceDropdown() {
            document.getElementById('provinceDropdown').classList.toggle('hidden');
        }

        function toggleMunicipalityDropdown() {
            document.getElementById('municipalityDropdown').classList.toggle('hidden');
        }

        function toggleBarangayDropdown() {
            document.getElementById('barangayDropdown').classList.toggle('hidden');
        }

        function selectProvince(province) {
            document.getElementById('province').value = province;
            document.getElementById('provinceDropdown').classList.add('hidden');
            
            // Clear dependent fields
            document.getElementById('municipality').value = '';
            document.getElementById('barangay').value = '';
            
            // Load municipalities for selected province
            loadMunicipalities(province);
        }

        function selectMunicipality(municipality, municipalityCode) {
            document.getElementById('municipality').value = municipality;
            document.getElementById('municipalityDropdown').classList.add('hidden');
            
            // Clear dependent field
            document.getElementById('barangay').value = '';
            
            // Load barangays for selected municipality
            loadBarangays(municipality, municipalityCode);
        }

        function selectBarangay(barangay) {
            document.getElementById('barangay').value = barangay;
            document.getElementById('barangayDropdown').classList.add('hidden');
        }

        async function resetForm() {
            document.getElementById('studentForm').reset();
            
            // Reset middle name field properly
            resetMiddleNameField();
            
            // Reset character counters
            updateCounter('lastName', 'lastNameCounter', 50);
            updateCounter('firstName', 'firstNameCounter', 50);
            updateCounter('middleName', 'middleNameCounter', 50);
            updateCounter('address', 'addressCounter', 200);
            
            // Generate new student ID
            await setAutoGeneratedId();
        }

        function toggleMiddleName() {
            const checkbox = document.getElementById('hasMiddleName');
            const middleNameField = document.getElementById('middleName');
            
            if (checkbox.checked) {
                middleNameField.disabled = false;
                middleNameField.classList.remove('bg-gray-100', 'cursor-not-allowed');
                middleNameField.classList.add('focus:outline-none', 'focus:ring-2', 'focus:ring-blue-500');
            } else {
                middleNameField.disabled = true;
                middleNameField.value = '';
                middleNameField.classList.add('bg-gray-100', 'cursor-not-allowed');
                middleNameField.classList.remove('focus:ring-2', 'focus:ring-blue-500');
                updateCounter('middleName', 'middleNameCounter', 50);
            }
        }

        let currentYearFilter = null;
        let isTableHidden = false;

        function filterByYear(yearLevel) {
            const tableContainer = document.getElementById('studentTableContainer');
            const buttons = ['btn1st', 'btn2nd', 'btn3rd', 'btn4th', 'btnAll'];
            
            // Reset all button styles
            buttons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('bg-blue-100', 'text-blue-900');
            });
            
            // Prevent camera movement by maintaining scroll position
            const scrollPosition = window.pageYOffset;
            
            // If clicking the same year button, toggle hide/show
            if (currentYearFilter === yearLevel) {
                if (isTableHidden) {
                    tableContainer.classList.remove('hidden');
                    isTableHidden = false;
                } else {
                    // Use opacity instead of display:none to maintain layout
                    tableContainer.style.opacity = '0';
                    setTimeout(() => {
                        tableContainer.classList.add('hidden');
                        tableContainer.style.opacity = '';
                    }, 200);
                    isTableHidden = true;
                }
            } else {
                // Show table and filter by year
                tableContainer.classList.remove('hidden');
                tableContainer.style.opacity = '';
                isTableHidden = false;
                currentYearFilter = yearLevel;
                
                // Highlight active button
                const activeBtn = document.getElementById(`btn${yearLevel.split(' ')[0].toLowerCase()}`);
                activeBtn.classList.remove('bg-blue-100', 'text-blue-900');
                activeBtn.classList.add('bg-blue-500', 'text-white');
                
                // Filter students
                const filteredStudents = allStudents.filter(student => student.yearLevel === yearLevel);
                displayStudents(filteredStudents);
            }
            
            // Restore scroll position to prevent camera movement
            window.scrollTo(0, scrollPosition);
        }

        function showAllYears() {
            const tableContainer = document.getElementById('studentTableContainer');
            const buttons = ['btn1st', 'btn2nd', 'btn3rd', 'btn4th', 'btnAll'];
            
            // Prevent camera movement by maintaining scroll position
            const scrollPosition = window.pageYOffset;
            
            // Reset all button styles
            buttons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                btn.classList.remove('bg-blue-500', 'text-white', 'bg-gray-500');
                if (btnId === 'btnAll') {
                    btn.classList.add('bg-gray-500', 'text-white');
                } else {
                    btn.classList.add('bg-blue-100', 'text-blue-900');
                }
            });
            
            // Show table and display all students
            tableContainer.classList.remove('hidden');
            tableContainer.style.opacity = '';
            isTableHidden = false;
            currentYearFilter = null;
            displayStudents(allStudents);
            
            // Restore scroll position to prevent camera movement
            window.scrollTo(0, scrollPosition);
        }

        // Remove old subject modal code since we're now using database data

        function openEditAddressModal() {
            document.getElementById('addressModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Set flag to know we're editing
            document.getElementById('addressModal').setAttribute('data-edit-mode', 'true');
        }

        // Subject modal functions
        function openAddSubjectModal() {
            const modal = document.getElementById('addSubjectModal');
            modal.classList.remove('hidden');
            
            // Enhanced animation sequence
            const modalContent = modal.querySelector('.bg-gradient-to-br');
            modalContent.classList.remove('scale-95');
            modalContent.classList.add('scale-100');
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
            
            // Focus on first field for better UX
            setTimeout(() => {
                document.getElementById('subjectCode').focus();
            }, 300);
        }
        
        function closeAddSubjectModal() {
            const modal = document.getElementById('addSubjectModal');
            const modalContent = modal.querySelector('.bg-gradient-to-br');
            
            // Enhanced closing animation
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            
            // Fade out and hide modal
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                
                // Reset form for clean state
                document.getElementById('addSubjectForm').reset();
                
                // Reset all counters
                updateSubjectCounter('subjectCode', 'subjectCodeCounter', 20);
                updateSubjectCounter('subjectTitle', 'subjectTitleCounter', 100);
                updateSubjectCounter('subjectPrerequisites', 'subjectPrerequisitesCounter', 200);
                updateSubjectCounter('subjectDescription', 'subjectDescriptionCounter', 500);
            }, 300);
        }
        
        // Subject counter function
        function updateSubjectCounter(inputId, counterId, maxLength) {
            const input = document.getElementById(inputId);
            const counter = document.getElementById(counterId);
            
            if (!input || !counter) return;
            
            const currentLength = input.value.length;
            
            counter.textContent = `${currentLength}/${maxLength}`;
            
            // Change color when approaching limit
            if (currentLength >= maxLength * 0.9) {
                counter.classList.add('text-red-500', 'font-bold');
                counter.classList.remove('text-purple-600', 'text-blue-600', 'text-gray-600');
            } else {
                counter.classList.remove('text-red-500', 'font-bold');
                // Restore original color based on field
                if (inputId.includes('Code')) {
                    counter.classList.add('text-purple-600');
                } else if (inputId.includes('Title')) {
                    counter.classList.add('text-blue-600');
                } else {
                    counter.classList.add('text-gray-600');
                }
            }
        }
        
        // Subject form submission
        document.getElementById('addSubjectForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const subject = {
                code: document.getElementById('subjectCode').value,
                title: document.getElementById('subjectTitle').value,
                units: parseInt(document.getElementById('subjectUnits').value),
                semester: document.getElementById('subjectSemester').value,
                yearLevel: document.getElementById('subjectYearLevel').value,
                prerequisites: document.getElementById('subjectPrerequisites').value,
                description: document.getElementById('subjectDescription').value
            };

            try {
                // For now, we'll just add to local storage until backend is ready
                let subjects = JSON.parse(localStorage.getItem('subjects') || '[]');
                subject.id = Date.now().toString(); // Simple ID generation
                subjects.push(subject);
                localStorage.setItem('subjects', JSON.stringify(subjects));
                
                // Show success message
                alert(`Subject "${subject.code} - ${subject.title}" added successfully!`);
                
                // Close modal and reload subjects
                closeAddSubjectModal();
                loadSubjects();
                
            } catch (error) {
                alert('Error adding subject: ' + error.message);
            }
        });
        
        // Load subjects function
        function loadSubjects() {
            try {
                const subjects = JSON.parse(localStorage.getItem('subjects') || '[]');
                displaySubjects(subjects);
            } catch (error) {
                console.error('Error loading subjects:', error);
            }
        }
        
        // Display subjects function
        function displaySubjects(subjects) {
            const tbody = document.getElementById('subjectsTableBody');
            tbody.innerHTML = '';
            
            if (subjects.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500 border border-gray-300">No subjects added yet. Click "Add New Subject" to get started.</td></tr>';
                return;
            }
            
            subjects.forEach((subject, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td class="px-4 py-3 border border-gray-300 text-sm font-semibold text-gray-900 text-center">${index + 1}</td>
                    <td class="px-4 py-3 border border-gray-300 text-sm font-bold text-purple-600">${subject.code}</td>
                    <td class="px-4 py-3 border border-gray-300 text-sm font-semibold text-gray-900">${subject.title}</td>
                    <td class="px-4 py-3 border border-gray-300 text-sm font-semibold text-center text-green-600">${subject.units}</td>
                    <td class="px-4 py-3 border border-gray-300 text-center">
                        <button onclick="editSubject('${subject.id}')" class="bg-blue-500 hover:bg-blue-600 text-white p-2 rounded mr-1 text-sm font-bold" title="Edit Subject">
                            ✏️
                        </button>
                        <button onclick="deleteSubject('${subject.id}')" class="bg-red-500 hover:bg-red-600 text-white p-2 rounded text-sm font-bold" title="Delete Subject">
                            🗑️
                        </button>
                    </td>
                `;
            });
        }
        
        // Edit subject function (placeholder)
        function editSubject(id) {
            alert('Edit subject functionality will be implemented in the next update.');
        }
        
        // Delete subject function
        function deleteSubject(id) {
            if (confirm('Are you sure you want to delete this subject?')) {
                try {
                    let subjects = JSON.parse(localStorage.getItem('subjects') || '[]');
                    subjects = subjects.filter(subject => subject.id !== id);
                    localStorage.setItem('subjects', JSON.stringify(subjects));
                    loadSubjects();
                    alert('Subject deleted successfully!');
                } catch (error) {
                    alert('Error deleting subject: ' + error.message);
                }
            }
        }
        
        // Load subjects when class record section is shown
        function showSection(section) {
            document.getElementById('studentsSection').classList.add('hidden');
            document.getElementById('gradingSection').classList.add('hidden');
            document.getElementById('classrecordSection').classList.add('hidden');
            document.getElementById('syllabusSection').classList.add('hidden');
            
            if (section === 'students') {
                document.getElementById('studentsSection').classList.remove('hidden');
                // Reset grading period layout
                resetGradingPeriod();
            } else if (section === 'grading') {
                document.getElementById('gradingSection').classList.remove('hidden');
            } else if (section === 'classrecord') {
                document.getElementById('classrecordSection').classList.remove('hidden');
                // Load subjects when section is shown
                loadSubjects();
            } else if (section === 'syllabus') {
                document.getElementById('syllabusSection').classList.remove('hidden');
            }
        }

        // Enhanced keyboard event handling
        document.addEventListener('keydown', function(event) {
            // Close filter panel with Escape key
            if (event.key === 'Escape') {
                const filterOverlay = document.getElementById('filterOverlay');
                if (filterOverlay && !filterOverlay.classList.contains('hidden')) {
                    closeFilters();
                    event.preventDefault();
                }
                
                // Also close address modal if open
                const addressModal = document.getElementById('addressModal');
                if (addressModal && !addressModal.classList.contains('hidden')) {
                    closeAddressModal();
                    event.preventDefault();
                }
            }
        });
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            const dropdowns = ['regionDropdown', 'provinceDropdown', 'municipalityDropdown', 'barangayDropdown'];
            const buttons = ['toggleRegionDropdown', 'toggleProvinceDropdown', 'toggleMunicipalityDropdown', 'toggleBarangayDropdown'];
            
            dropdowns.forEach((dropdownId, index) => {
                const dropdown = document.getElementById(dropdownId);
                const isClickOnButton = event.target.closest(`button[onclick="${buttons[index]}()"]`);
                const isClickInDropdown = event.target.closest(`#${dropdownId}`);
                
                if (!isClickOnButton && !isClickInDropdown && dropdown) {
                    dropdown.classList.add('hidden');
                }
            });
            
            // Enhanced filter panel outside click handling
            const filterPanel = document.getElementById('filterSidePanel');
            const filterOverlay = document.getElementById('filterOverlay');
            const filterButton = event.target.closest('button[onclick="toggleFilters()"]');
            const isClickInPanel = event.target.closest('#filterSidePanel');
            const isClickOnOverlay = event.target.closest('#filterOverlay');
            
            // Close filter panel if clicking outside and panel is open
            if (filterPanel && filterOverlay && !filterOverlay.classList.contains('hidden')) {
                if (!filterButton && !isClickInPanel && (isClickOnOverlay || !event.target.closest('#filterSidePanel, #filterOverlay'))) {
                    closeFilters();
                }
            }
        });
    </script>



    <!-- Footer -->
    <footer class="relative mt-16 bg-gradient-to-br from-slate-50 via-white to-indigo-50 border-t-2 border-slate-200 backdrop-blur-sm">
        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-slate-100/20 to-transparent"></div>
        <div class="relative max-w-7xl mx-auto px-6 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
                <!-- Brand Section -->
                <div class="flex items-center space-x-3">
                    <div class="flex items-center justify-center h-10 w-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 shadow-lg">
                        <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-black text-slate-800 tracking-wide">W3BFORGE BCC</h3>
                        <p class="text-xs font-semibold text-slate-500 tracking-wider">STUDENT MANAGEMENT SYSTEM</p>
                    </div>
                </div>
                
                <!-- Links Section -->
                <div class="flex items-center space-x-8">
                    <div class="flex space-x-6">
                        <a href="#" onclick="showSection('students')" class="text-sm font-bold text-slate-600 hover:text-indigo-600 transition-colors duration-200 tracking-wide">STUDENTS</a>
                        <a href="#" onclick="showSection('grading')" class="text-sm font-bold text-slate-600 hover:text-purple-600 transition-colors duration-200 tracking-wide">GRADING</a>
                        <a href="#" onclick="showSection('syllabus')" class="text-sm font-bold text-slate-600 hover:text-blue-600 transition-colors duration-200 tracking-wide">CURRICULUM</a>
                    </div>
                </div>
                
                <!-- Copyright Section -->
                <div class="text-center md:text-right">
                    <p class="text-sm font-semibold text-slate-500 tracking-wide">
                        © 2025 <span class="font-black text-slate-700">W3BFORGE BCC</span>
                    </p>
                    <p class="text-xs font-medium text-slate-400 tracking-wider mt-1">
                        ALL RIGHTS RESERVED
                    </p>
                </div>
            </div>
            
            <!-- Decorative Line -->
            <div class="mt-6 pt-6 border-t border-slate-200">
                <div class="flex items-center justify-center">
                    <div class="h-px bg-gradient-to-r from-transparent via-slate-300 to-transparent w-full max-w-xs"></div>
                    <div class="mx-4 flex items-center justify-center h-8 w-8 rounded-full bg-gradient-to-br from-slate-100 to-slate-200 border border-slate-300">
                        <svg class="h-4 w-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <div class="h-px bg-gradient-to-r from-transparent via-slate-300 to-transparent w-full max-w-xs"></div>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>